[
  {
    "library_name": "Rails",
    "url": "https://github.com/rails/rails/releases/tag/v8.0.2",
    "version": "v8.0.2",
    "title": "Release 8.0.2 · rails/rails · GitHub",
    "release_date": "2025-03-12T03:06:51Z",
    "content": "Active Support\nFix setting\nto_time_preserves_timezone\nfrom\nnew_framework_defaults_8_0.rb\n.\nfatkodima\nFix Active Support Cache\nfetch_multi\nwhen local store is active.\nfetch_multi\nnow properly yield to the provided block for missing entries\nthat have been recorded as such in the local store.\nJean Boussier\nFix execution wrapping to report all exceptions, including\nException\n.\nIf a more serious error like\nSystemStackError\nor\nNoMemoryError\nhappens,\nthe error reporter should be able to report these kinds of exceptions.\nGannon McGibbon\nFix\nRedisCacheStore\nand\nMemCacheStore\nto also handle connection pool related errors.\nThese errors are rescued and reported to\nRails.error\n.\nJean Boussier\nFix\nActiveSupport::Cache#read_multi\nto respect version expiry when using local cache.\nzzak\nFix\nActiveSupport::MessageVerifier\nand\nActiveSupport::MessageEncryptor\nconfiguration of\non_rotation\ncallback.\nverifier\n.\nrotate\n(\nold_secret\n)\n.\non_rotation\n{\n...\n}\nNow both work as documented.\nJean Boussier\nFix\nActiveSupport::MessageVerifier\nto always be able to verify both URL-safe and URL-unsafe payloads.\nThis is to allow transitioning seemlessly from either configuration without immediately invalidating\nall previously generated signed messages.\nJean Boussier\n,\nFlorent Beaurain\n,\nAli Sepehri\nFix\ncache.fetch\nto honor the provided expiry when\n:race_condition_ttl\nis used.\ncache\n.\nfetch\n(\n\"key\"\n,\nexpires_in\n:\n1\n.\nhour\n,\nrace_condition_ttl\n:\n5\n.\nsecond\n)\ndo\n\"something\"\nend\nIn the above example, the final cache entry would have a 10 seconds TTL instead\nof the requested 1 hour.\nDhia\nBetter handle procs with splat arguments in\nset_callback\n.\nRadamés Roriz\nFix\nString#mb_chars\nto not mutate the receiver.\nPreviously it would call\nforce_encoding\non the receiver,\nnow it dups the receiver first.\nJean Boussier\nImprove\nErrorSubscriber\nto also mark error causes as reported.\nThis avoid some cases of errors being reported twice, notably in views because of how\nerrors are wrapped in\nActionView::Template::Error\n.\nJean Boussier\nFix\nModule#module_parent_name\nto return the correct name after the module has been named.\nWhen called on an anonymous module, the return value wouldn't change after the module was given a name\nlater by being assigned to a constant.\nmod\n=\nModule\n.\nnew\nmod\n.\nmodule_parent_name\n# => \"Object\"\nMyModule\n::\nSomething\n=\nmod\nmod\n.\nmodule_parent_name\n# => \"MyModule\"\nJean Boussier\nActive Model\nNo changes.\nActive Record\nFix inverting\nrename_enum_value\nwhen\n:from\n/\n:to\nare provided.\nfatkodima\nPrevent persisting invalid record.\nEdouard Chin\nFix inverting\ndrop_table\nwithout options.\nfatkodima\nFix count with group by qualified name on loaded relation.\nRyuta Kamizono\nFix\nsum\nwith qualified name on loaded relation.\nChris Gunther\nThe SQLite3 adapter quotes non-finite Numeric values like \"Infinity\" and \"NaN\".\nMike Dalessio\nHandle libpq returning a database version of 0 on no/bad connection in\nPostgreSQLAdapter\n.\nBefore, this version would be cached and an error would be raised during connection configuration when\ncomparing it with the minimum required version for the adapter. This meant that the connection could\nnever be successfully configured on subsequent reconnection attempts.\nNow, this is treated as a connection failure consistent with libpq, raising a\nActiveRecord::ConnectionFailed\nand ensuring the version isn't cached, which allows the version to be retrieved on the next connection attempt.\nJoshua Young\n,\nRian McGuire\nFix error handling during connection configuration.\nActive Record wasn't properly handling errors during the connection configuration phase.\nThis could lead to a partially configured connection being used, resulting in various exceptions,\nthe most common being with the PostgreSQLAdapter raising\nundefined method\nkey?' for nil\nor\nTypeError: wrong argument type nil (expected PG::TypeMap)`.\nJean Boussier\nFix a case where a non-retryable query could be marked retryable.\nHartley McGuire\nHandle circular references when autosaving associations.\nzzak\nPoolConfig no longer keeps a reference to the connection class.\nKeeping a reference to the class caused subtle issues when combined with reloading in\ndevelopment. Fixes\n#54343\n.\nMike Dalessio\nFix SQL notifications sometimes not sent when using async queries.\nPost\n.\nasync_count\nActiveSupport\n::\nNotifications\n.\nsubscribed\n(\n->\n(\n*\n)\n{\n\"Will never reach here\"\n}\n)\ndo\nPost\n.\ncount\nend\nIn rare circumstances and under the right race condition, Active Support notifications\nwould no longer be dispatched after using an asynchronous query.\nThis is now fixed.\nEdouard Chin\nFix support for PostgreSQL enum types with commas in their name.\nArthur Hess\nFix inserts on MySQL with no RETURNING support for a table with multiple auto populated columns.\nNikita Vasilevsky\nFix joining on a scoped association with string joins and bind parameters.\nclass\nInstructor\n<\nActiveRecord\n::\nBase\nhas_many\n:instructor_roles\n,\n->\n{\nactive\n}\nend\nclass\nInstructorRole\n<\nActiveRecord\n::\nBase\nscope\n:active\n,\n->\n{\njoins\n(\n\"JOIN students ON instructor_roles.student_id = students.id\"\n)\n.\nwhere\n(\nstudents\n{\nstatus\n:\n1\n}\n)\n}\nend\nInstructor\n.\njoins\n(\n:instructor_roles\n)\n.\nfirst\nThe above example would result in\nActiveRecord::StatementInvalid\nbecause the\nactive\nscope bind parameters would be lost.\nJean Boussier\nFix a potential race condition with system tests and transactional fixtures.\nSjoerd Lagarde\nFix autosave associations to no longer validated unmodified associated records.\nActive Record was incorrectly performing validation on associated record that\nweren't created nor modified as part of the transaction:\nPost\n.\ncreate!\n(\nauthor\n:\nUser\n.\nfind\n(\n1\n)\n)\n# Fail if user is invalid\nJean Boussier\nRemember when a database connection has recently been verified (for\ntwo seconds, by default), to avoid repeated reverifications during a\nsingle request.\nThis should recreate a similar rate of verification as in Rails 7.1,\nwhere connections are leased for the duration of a request, and thus\nonly verified once.\nMatthew Draper\nAction View\nRespect\nhtml_options[:form]\nwhen\ncollection_checkboxes\ngenerates the\nhidden\n<input>\n.\nRiccardo Odone\nLayouts have access to local variables passed to\nrender\n.\nThis fixes\n#31680\nwhich was a regression in Rails 5.1.\nMike Dalessio\nArgument errors related to strict locals in templates now raise an\nActionView::StrictLocalsError\n, and all other argument errors are reraised as-is.\nPreviously, any\nArgumentError\nraised during template rendering was swallowed during strict\nlocal error handling, so that an\nArgumentError\nunrelated to strict locals (e.g., a helper\nmethod invoked with incorrect arguments) would be replaced by a similar\nArgumentError\nwith an\nunrelated backtrace, making it difficult to debug templates.\nNow, any\nArgumentError\nunrelated to strict locals is reraised, preserving the original\nbacktrace for developers.\nAlso note that\nActionView::StrictLocalsError\nis a subclass of\nArgumentError\n, so any existing\ncode that rescues\nArgumentError\nwill continue to work.\nFixes\n#52227\n.\nMike Dalessio\nFix stack overflow error in dependency tracker when dealing with circular dependencies\nJean Boussier\nAction Pack\nImprove\nwith_routing\ntest helper to not rebuild the middleware stack.\nOtherwise some middleware configuration could be lost.\nÉdouard Chin\nAdd resource name to the\nArgumentError\nthat's raised when invalid\n:only\nor\n:except\noptions are given to\n#resource\nor\n#resources\nThis makes it easier to locate the source of the problem, especially for routes drawn by gems.\nBefore:\n:only and :except must include only [:index, :create, :new, :show, :update, :destroy, :edit], but also included [:foo, :bar]\nAfter:\nRoute `resources :products` - :only and :except must include only [:index, :create, :new, :show, :update, :destroy, :edit], but also included [:foo, :bar]\nJeremy Green\nFix\nurl_for\nto handle\n:path_params\ngracefully when it's not a\nHash\n.\nPrevents various security scanners from causing exceptions.\nMartin Emde\nFix\nActionDispatch::Executor\nto unwrap exceptions like other error reporting middlewares.\nJean Boussier\nActive Job\nNo changes.\nAction Mailer\nNo changes.\nAction Cable\nNo changes.\nActive Storage\nA Blob will no longer autosave associated Attachment.\nThis fixes an issue where a record with an attachment would have\nits dirty attributes reset, preventing your\nafter commit\ncallbacks\non that record to behave as expected.\nNote that this change doesn't require any changes on your application\nand is supposed to be internal. Active Storage Attachment will continue\nto be autosaved (through a different relation).\nEdouard-chin\nAction Mailbox\nNo changes.\nAction Text\nNo changes.\nRailties\nFix Rails console to load routes.\nOtherwise\n*_path\nand\n*url\nmethods are missing on the\napp\nobject.\nÉdouard Chin\nUpdate\nrails new --minimal\noption\nExtend the\n--minimal\nflag to exclude recently added features:\nskip_brakeman\n,\nskip_ci\n,\nskip_docker\n,\nskip_kamal\n,\nskip_rubocop\n,\nskip_solid\nand\nskip_thruster\n.\neelcoj\nUse\nsecret_key_base\nfrom ENV or credentials when present locally.\nWhen ENV[\"SECRET_KEY_BASE\"] or\nRails.application.credentials.secret_key_base\nis set for test or\ndevelopment, it is used for the\nRails.config.secret_key_base\n,\ninstead of generating a\ntmp/local_secret.txt\nfile.\nPetrik de Heus\nGuides\nNo changes.",
    "crawl_status": "success"
  },
  {
    "library_name": "Rails",
    "url": "https://github.com/rails/rails/releases/tag/v7.2.0",
    "version": "v7.2.0",
    "title": "Release 7.2.0 · rails/rails · GitHub",
    "release_date": "2024-08-10T00:04:51Z",
    "content": "Active Support\nFix\ndelegate_missing_to allow_nil: true\nwhen called with implict self\nclass\nPerson\ndelegate_missing_to\n:address\n,\nallow_nil\n:\ntrue\ndef\naddress\nnil\nend\ndef\nberliner?\ncity\n==\n\"Berlin\"\nend\nend\nPerson\n.\nnew\n.\ncity\n# => nil\nPerson\n.\nnew\n.\nberliner?\n# undefined local variable or method `city' for an instance of Person (NameError)\nJean Boussier\nAdd\nlogger\nas a dependency since it is a bundled gem candidate for Ruby 3.5\nEarlopain\nDefine\nDigest::UUID.nil_uuid\n, which returns the so-called nil UUID.\nXavier Noria\nSupport\nduration\ntype in\nActiveSupport::XmlMini\n.\nheka1024\nRemove deprecated\nActiveSupport::Notifications::Event#children\nand\nActiveSupport::Notifications::Event#parent_of?\n.\nRafael Mendonça França\nRemove deprecated support to call the following methods without passing a deprecator:\ndeprecate\ndeprecate_constant\nActiveSupport::Deprecation::DeprecatedObjectProxy.new\nActiveSupport::Deprecation::DeprecatedInstanceVariableProxy.new\nActiveSupport::Deprecation::DeprecatedConstantProxy.new\nassert_deprecated\nassert_not_deprecated\ncollect_deprecations\nRafael Mendonça França\nRemove deprecated\nActiveSupport::Deprecation\ndelegation to instance.\nRafael Mendonça França\nRemove deprecated\nSafeBuffer#clone_empty\n.\nRafael Mendonça França\nRemove deprecated\n#to_default_s\nfrom\nArray\n,\nDate\n,\nDateTime\nand\nTime\n.\nRafael Mendonça França\nRemove deprecated support to passing\nDalli::Client\ninstances to\nMemCacheStore\n.\nRafael Mendonça França\nRemove deprecated\nconfig.active_support.use_rfc4122_namespaced_uuids\n.\nRafael Mendonça França\nRemove deprecated\nconfig.active_support.remove_deprecated_time_with_zone_name\n.\nRafael Mendonça França\nRemove deprecated\nconfig.active_support.disable_to_s_conversion\n.\nRafael Mendonça França\nRemove deprecated support to bolding log text with positional boolean in\nActiveSupport::LogSubscriber#color\n.\nRafael Mendonça França\nRemove deprecated constants\nActiveSupport::LogSubscriber::CLEAR\nand\nActiveSupport::LogSubscriber::BOLD\n.\nRafael Mendonça França\nRemove deprecated support for\nconfig.active_support.cache_format_version = 6.1\n.\nRafael Mendonça França\nRemove deprecated\n:pool_size\nand\n:pool_timeout\noptions for the cache storage.\nRafael Mendonça França\nWarn on tests without assertions.\nActiveSupport::TestCase\nnow warns when tests do not run any assertions.\nThis is helpful in detecting broken tests that do not perform intended assertions.\nfatkodima\nSupport\nhexBinary\ntype in\nActiveSupport::XmlMini\n.\nheka1024\nDeprecate\nActiveSupport::ProxyObject\nin favor of Ruby's built-in\nBasicObject\n.\nEarlopain\nstub_const\nnow accepts a\nexists: false\nparameter to allow stubbing missing constants.\nJean Boussier\nMake\nActiveSupport::BacktraceCleaner\ncopy filters and silencers on dup and clone.\nPreviously the copy would still share the internal silencers and filters array,\ncausing state to leak.\nJean Boussier\nUpdating Astana with Western Kazakhstan TZInfo identifier.\nDamian Nelson\nAdd filename support for\nActiveSupport::Logger.logger_outputs_to?\n.\nlogger\n=\nLogger\n.\nnew\n(\n'/var/log/rails.log'\n)\nActiveSupport\n::\nLogger\n.\nlogger_outputs_to?\n(\nlogger\n,\n'/var/log/rails.log'\n)\nChristian Schmidt\nInclude\nIPAddr#prefix\nwhen serializing an\nIPAddr\nusing the\nActiveSupport::MessagePack\nserializer.\nThis change is backward and forward compatible — old payloads can\nstill be read, and new payloads will be readable by older versions of Rails.\nTaiki Komaba\nAdd\ndefault:\nsupport for\nActiveSupport::CurrentAttributes.attribute\n.\nclass\nCurrent\n<\nActiveSupport\n::\nCurrentAttributes\nattribute\n:counter\n,\ndefault\n:\n0\nend\nSean Doyle\nYield instance to\nObject#with\nblock.\nclient\n.\nwith\n(\ntimeout\n:\n5_000\n)\ndo\n|\nc\n|\nc\n.\nget\n(\n\"/commits\"\n)\nend\nSean Doyle\nUse logical core count instead of physical core count to determine the\ndefault number of workers when parallelizing tests.\nJonathan Hefner\nFix\nTime.now/DateTime.now/Date.today\nto return results in a system timezone after\n#travel_to\n.\nThere is a bug in the current implementation of #travel_to:\nit remembers a timezone of its argument, and all stubbed methods start\nreturning results in that remembered timezone. However, the expected\nbehavior is to return results in a system timezone.\nAleksei Chernenkov\nAdd\nErrorReported#unexpected\nto report precondition violations.\nFor example:\ndef\nedit\nif\npublished?\nRails\n.\nerror\n.\nunexpected\n(\n\"[BUG] Attempting to edit a published article, that shouldn't be possible\"\n)\nreturn\nfalse\nend\n# ...\nend\nThe above will raise an error in development and test, but only report the error in production.\nJean Boussier\nMake the order of read_multi and write_multi notifications for\nCache::Store#fetch_multi\noperations match the order they are executed in.\nAdam Renberg Tamm\nMake return values of\nCache::Store#write\nconsistent.\nThe return value was not specified before. Now it returns\ntrue\non a successful write,\nnil\nif there was an error talking to the cache backend, and\nfalse\nif the write failed\nfor another reason (e.g. the key already exists and\nunless_exist: true\nwas passed).\nSander Verdonschot\nFix logged cache keys not always matching actual key used by cache action.\nHartley McGuire\nImprove error messages of\nassert_changes\nand\nassert_no_changes\n.\nassert_changes\nerror messages now display objects with\n.inspect\nto make it easier\nto differentiate nil from empty strings, strings from symbols, etc.\nassert_no_changes\nerror messages now surface the actual value.\npcreux\nFix\n#to_fs(:human_size)\nto correctly work with negative numbers.\nEarlopain\nFix\nBroadcastLogger#dup\nso that it duplicates the logger's\nbroadcasts\n.\nAndrew Novoselac\nFix issue where\nbootstrap.rb\noverwrites the\nlevel\nof a\nBroadcastLogger\n's\nbroadcasts\n.\nAndrew Novoselac\nFix compatibility with the\nsemantic_logger\ngem.\nThe\nsemantic_logger\ngem doesn't behave exactly like stdlib logger in that\nSemanticLogger#level\nreturns a Symbol while stdlib\nLogger#level\nreturns an Integer.\nThis caused the various\nLogSubscriber\nclasses in Rails to break when assigned a\nSemanticLogger\ninstance.\nJean Boussier\n,\nojab\nFix MemoryStore to prevent race conditions when incrementing or decrementing.\nPierre Jambet\nImplement\nHashWithIndifferentAccess#to_proc\n.\nPreviously, calling\n#to_proc\non\nHashWithIndifferentAccess\nobject used inherited\n#to_proc\nmethod from the\nHash\nclass, which was not able to access values using indifferent keys.\nfatkodima\nActive Model\nFix a bug where type casting of string to\nTime\nand\nDateTime\ndoesn't\ncalculate minus minute value in TZ offset correctly.\nAkira Matsuda\nPort the\ntype_for_attribute\nmethod to Active Model. Classes that include\nActiveModel::Attributes\nwill now provide this method. This method behaves\nthe same for Active Model as it does for Active Record.\nclass\nMyModel\ninclude\nActiveModel\n::\nAttributes\nattribute\n:my_attribute\n,\n:integer\nend\nMyModel\n.\ntype_for_attribute\n(\n:my_attribute\n)\n# => #<ActiveModel::Type::Integer ...>\nJonathan Hefner\nActive Record\nHandle commas in Sqlite3 default function definitions.\nStephen Margheim\nFixes\nvalidates_associated\nraising an exception when configured with a\nsingular association and having\nindex_nested_attribute_errors\nenabled.\nMartin Spickermann\nThe constant\nActiveRecord::ImmutableRelation\nhas been deprecated because\nwe want to reserve that name for a stronger sense of \"immutable relation\".\nPlease use\nActiveRecord::UnmodifiableRelation\ninstead.\nXavier Noria\nAdd condensed\n#inspect\nfor\nConnectionPool\n,\nAbstractAdapter\n, and\nDatabaseConfig\n.\nHartley McGuire\nFixed a memory performance issue in Active Record attribute methods definition.\nJean Boussier\nDefine the new Active Support notification event\nstart_transaction.active_record\n.\nThis event is fired when database transactions or savepoints start, and\ncomplements\ntransaction.active_record\n, which is emitted when they finish.\nThe payload has the transaction (\n:transaction\n) and the connection (\n:connection\n).\nXavier Noria\nFix an issue where the IDs reader method did not return expected results\nfor preloaded associations in models using composite primary keys.\nJay Ang\nThe payload of\nsql.active_record\nActive Support notifications now has the current transaction in the\n:transaction\nkey.\nXavier Noria\nThe payload of\ntransaction.active_record\nActive Support notifications now has the transaction the event is related to in the\n:transaction\nkey.\nXavier Noria\nDefine\nActiveRecord::Transaction#uuid\n, which returns a UUID for the database transaction. This may be helpful when tracing database activity. These UUIDs are generated only on demand.\nXavier Noria\nFix inference of association model on nested models with the same demodularized name.\nE.g. with the following setup:\nclass\nNested\n::\nPost\n<\nApplicationRecord\nhas_one\n:post\n,\nthrough\n:\n:other\nend\nBefore,\n#post\nwould infer the model as\nNested::Post\n, but now it correctly infers\nPost\n.\nJoshua Young\nPostgreSQL\nCidr#change?\ndetects the address prefix change.\nTaketo Takashima\nChange\nBatchEnumerator#destroy_all\nto return the total number of affected rows.\nPreviously, it always returned\nnil\n.\nfatkodima\nSupport\ntouch_all\nin batches.\nPost\n.\nin_batches\n.\ntouch_all\nfatkodima\nAdd support for\n:if_not_exists\nand\n:force\noptions to\ncreate_schema\n.\nfatkodima\nFix\nindex_errors\nhaving incorrect index in association validation errors.\nlulalala\nAdd\nindex_errors: :nested_attributes_order\nmode.\nThis indexes the association validation errors based on the order received by nested attributes setter, and respects the\nreject_if\nconfiguration. This enables API to provide enough information to the frontend to map the validation errors back to their respective form fields.\nlulalala\nAdd\nRails.application.config.active_record.postgresql_adapter_decode_dates\nto opt out of decoding dates automatically with the postgresql adapter. Defaults to true.\nJoé Dupuis\nAssociation option\nquery_constraints\nis deprecated in favor of\nforeign_key\n.\nNikita Vasilevsky\nAdd\nENV[\"SKIP_TEST_DATABASE_TRUNCATE\"]\nflag to speed up multi-process test runs on large DBs when all tests run within default transaction.\nThis cuts ~10s from the test run of HEY when run by 24 processes against the 178 tables, since ~4,000 table truncates can then be skipped.\nDHH\nAdded support for recursive common table expressions.\nPost\n.\nwith_recursive\n(\npost_and_replies\n:\n[\nPost\n.\nwhere\n(\nid\n:\n42\n)\n,\nPost\n.\njoins\n(\n'JOIN post_and_replies ON posts.in_reply_to_id = post_and_replies.id'\n)\n,\n]\n)\nGenerates the following SQL:\nWITH RECURSIVE\n\"\npost_and_replies\n\"\nAS\n(\n  (\nSELECT\n\"\nposts\n\"\n.\n*\nFROM\n\"\nposts\n\"\nWHERE\n\"\nposts\n\"\n.\n\"\nid\n\"\n=\n42\n)\nUNION ALL\n(\nSELECT\n\"\nposts\n\"\n.\n*\nFROM\n\"\nposts\n\"\nJOIN\npost_and_replies\nON\nposts\n.\nin_reply_to_id\n=\npost_and_replies\n.\nid\n)\n)\nSELECT\n\"\nposts\n\"\n.\n*\nFROM\n\"\nposts\n\"\nClearlyClaire\nvalidate_constraint\ncan be called in a\nchange_table\nblock.\nex:\nchange_table\n:products\ndo\n|\nt\n|\nt\n.\ncheck_constraint\n\"price > discounted_price\"\n,\nname\n:\n\"price_check\"\n,\nvalidate\n:\nfalse\nt\n.\nvalidate_check_constraint\n\"price_check\"\nend\nCody Cutrer\nPostgreSQLAdapter\nnow decodes columns of type date to\nDate\ninstead of string.\nEx:\nActiveRecord\n::\nBase\n.\nconnection\n.\nselect_value\n(\n\"select '2024-01-01'::date\"\n)\n.\nclass\n#=> Date\nJoé Dupuis\nStrict loading using\n:n_plus_one_only\ndoes not eagerly load child associations.\nWith this change, child associations are no longer eagerly loaded, to\nmatch intended behavior and to prevent non-deterministic order issues caused\nby calling methods like\nfirst\nor\nlast\n. As\nfirst\nand\nlast\ndon't cause\nan N+1 by themselves, calling child associations will no longer raise.\nFixes\n#49473\n.\nBefore:\nperson\n=\nPerson\n.\nfind\n(\n1\n)\nperson\n.\nstrict_loading!\n(\nmode\n:\n:n_plus_one_only\n)\nperson\n.\nposts\n.\nfirst\n# SELECT * FROM posts WHERE person_id = 1; -- non-deterministic order\nperson\n.\nposts\n.\nfirst\n.\nfirm\n# raises ActiveRecord::StrictLoadingViolationError\nAfter:\nperson\n=\nPerson\n.\nfind\n(\n1\n)\nperson\n.\nstrict_loading!\n(\nmode\n:\n:n_plus_one_only\n)\nperson\n.\nposts\n.\nfirst\n# this is 1+1, not N+1\n# SELECT * FROM posts WHERE person_id = 1 ORDER BY id LIMIT 1;\nperson\n.\nposts\n.\nfirst\n.\nfirm\n# no longer raises\nReid Lynch\nAllow\nSqlite3Adapter\nto use\nsqlite3\ngem version\n2.x\n.\nMike Dalessio\nAllow\nActiveRecord::Base#pluck\nto accept hash values.\n# Before\nPost\n.\njoins\n(\n:comments\n)\n.\npluck\n(\n\"posts.id\"\n,\n\"comments.id\"\n,\n\"comments.body\"\n)\n# After\nPost\n.\njoins\n(\n:comments\n)\n.\npluck\n(\nposts\n:\n[\n:id\n]\n,\ncomments\n:\n[\n:id\n,\n:body\n]\n)\nfatkodima\nRaise an\nActiveRecord::ActiveRecordError\nerror when the MySQL database returns an invalid version string.\nKevin McPhillips\nActiveRecord::Base.transaction\nnow yields an\nActiveRecord::Transaction\nobject.\nThis allows to register callbacks on it.\nArticle\n.\ntransaction\ndo\n|\ntransaction\n|\narticle\n.\nupdate\n(\npublished\n:\ntrue\n)\ntransaction\n.\nafter_commit\ndo\nPublishNotificationMailer\n.\nwith\n(\narticle\n:\narticle\n)\n.\ndeliver_later\nend\nend\nJean Boussier\nAdd\nActiveRecord::Base.current_transaction\n.\nReturns the current transaction, to allow registering callbacks on it.\nArticle\n.\ncurrent_transaction\n.\nafter_commit\ndo\nPublishNotificationMailer\n.\nwith\n(\narticle\n:\narticle\n)\n.\ndeliver_later\nend\nJean Boussier\nAdd\nActiveRecord.after_all_transactions_commit\ncallback.\nUseful for code that may run either inside or outside a transaction and needs\nto perform work after the state changes have been properly persisted.\ndef\npublish_article\n(\narticle\n)\narticle\n.\nupdate\n(\npublished\n:\ntrue\n)\nActiveRecord\n.\nafter_all_transactions_commit\ndo\nPublishNotificationMailer\n.\nwith\n(\narticle\n:\narticle\n)\n.\ndeliver_later\nend\nend\nIn the above example, the block is either executed immediately if called outside\nof a transaction, or called after the open transaction is committed.\nIf the transaction is rolled back, the block isn't called.\nJean Boussier\nAdd the ability to ignore counter cache columns until they are backfilled.\nStarting to use counter caches on existing large tables can be troublesome, because the column\nvalues must be backfilled separately of the column addition (to not lock the table for too long)\nand before the use of\n:counter_cache\n(otherwise methods like\nsize\n/\nany?\n/etc, which use\ncounter caches internally, can produce incorrect results). People usually use database triggers\nor callbacks on child associations while backfilling before introducing a counter cache\nconfiguration to the association.\nNow, to safely backfill the column, while keeping the column updated with child records added/removed, use:\nclass\nComment\n<\nApplicationRecord\nbelongs_to\n:post\n,\ncounter_cache\n:\n{\nactive\n:\nfalse\n}\nend\nWhile the counter cache is not \"active\", the methods like\nsize\n/\nany?\n/etc will not use it,\nbut get the results directly from the database. After the counter cache column is backfilled, simply\nremove the\n{ active: false }\npart from the counter cache definition, and it will now be used by the\nmentioned methods.\nfatkodima\nRetry known idempotent SELECT queries on connection-related exceptions.\nSELECT queries we construct by walking the Arel tree and / or with known model attributes\nare idempotent and can safely be retried in the case of a connection error. Previously,\nadapters such as\nTrilogyAdapter\nwould raise\nActiveRecord::ConnectionFailed: Trilogy::EOFError\nwhen encountering a connection error mid-request.\nAdrianna Chang\nAllow association's\nforeign_key\nto be composite.\nquery_constraints\noption was the only way to configure a composite foreign key by passing an\nArray\n.\nNow it's possible to pass an Array value as\nforeign_key\nto achieve the same behavior of an association.\nNikita Vasilevsky\nAllow association's\nprimary_key\nto be composite.\nAssociation's\nprimary_key\ncan be composite when derived from associated model\nprimary_key\nor\nquery_constraints\n.\nNow it's possible to explicitly set it as composite on the association.\nNikita Vasilevsky\nAdd\nconfig.active_record.permanent_connection_checkout\nsetting.\nControls whether\nActiveRecord::Base.connection\nraises an error, emits a deprecation warning, or neither.\nActiveRecord::Base.connection\ncheckouts a database connection from the pool and keeps it leased until the end of\nthe request or job. This behavior can be undesirable in environments that use many more threads or fibers than there\nis available connections.\nThis configuration can be used to track down and eliminate code that calls\nActiveRecord::Base.connection\nand\nmigrate it to use\nActiveRecord::Base.with_connection\ninstead.\nThe default behavior remains unchanged, and there is currently no plans to change the default.\nJean Boussier\nAdd dirties option to uncached.\nThis adds a\ndirties\noption to\nActiveRecord::Base.uncached\nand\nActiveRecord::ConnectionAdapters::ConnectionPool#uncached\n.\nWhen set to\ntrue\n(the default), writes will clear all query caches belonging to the current thread.\nWhen set to\nfalse\n, writes to the affected connection pool will not clear any query cache.\nThis is needed by Solid Cache so that cache writes do not clear query caches.\nDonal McBreen\nDeprecate\nActiveRecord::Base.connection\nin favor of\n.lease_connection\n.\nThe method has been renamed as\nlease_connection\nto better reflect that the returned\nconnection will be held for the duration of the request or job.\nThis deprecation is a soft deprecation, no warnings will be issued and there is no\ncurrent plan to remove the method.\nJean Boussier\nDeprecate\nActiveRecord::ConnectionAdapters::ConnectionPool#connection\n.\nThe method has been renamed as\nlease_connection\nto better reflect that the returned\nconnection will be held for the duration of the request or job.\nJean Boussier\nExpose a generic fixture accessor for fixture names that may conflict with Minitest.\nassert_equal\n\"Ruby on Rails\"\n,\nweb_sites\n(\n:rubyonrails\n)\n.\nname\nassert_equal\n\"Ruby on Rails\"\n,\nfixture\n(\n:web_sites\n,\n:rubyonrails\n)\n.\nname\nJean Boussier\nUsing\nModel.query_constraints\nwith a single non-primary-key column used to raise as expected, but with an\nincorrect error message.\nThis has been fixed to raise with a more appropriate error message.\nJoshua Young\nFix\nhas_one\nassociation autosave setting the foreign key attribute when it is unchanged.\nThis behavior is also inconsistent with autosaving\nbelongs_to\nand can have unintended side effects like raising\nan\nActiveRecord::ReadonlyAttributeError\nwhen the foreign key attribute is marked as read-only.\nJoshua Young\nRemove deprecated behavior that would rollback a transaction block when exited using\nreturn\n,\nbreak\nor\nthrow\n.\nRafael Mendonça França\nDeprecate\nRails.application.config.active_record.commit_transaction_on_non_local_return\n.\nRafael Mendonça França\nRemove deprecated support to pass\nrewhere\nto\nActiveRecord::Relation#merge\n.\nRafael Mendonça França\nRemove deprecated support to pass\ndeferrable: true\nto\nadd_foreign_key\n.\nRafael Mendonça França\nRemove deprecated support to quote\nActiveSupport::Duration\n.\nRafael Mendonça França\nRemove deprecated\n#quote_bound_value\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::ConnectionAdapters::ConnectionPool#connection_klass\n.\nRafael Mendonça França\nRemove deprecated support to apply\n#connection_pool_list\n,\n#active_connections?\n,\n#clear_active_connections!\n,\n#clear_reloadable_connections!\n,\n#clear_all_connections!\nand\n#flush_idle_connections!\nto the connections pools\nfor the current role when the\nrole\nargument isn't provided.\nRafael Mendonça França\nRemove deprecated\n#all_connection_pools\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::ConnectionAdapters::SchemaCache#data_sources\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::ConnectionAdapters::SchemaCache.load_from\n.\nRafael Mendonça França\nRemove deprecated\n#all_foreign_keys_valid?\nfrom database adapters.\nRafael Mendonça França\nRemove deprecated support to passing coder and class as second argument to\nserialize\n.\nRafael Mendonça França\nRemove deprecated support to\nActiveRecord::Base#read_attribute(:id)\nto return the custom primary key value.\nRafael Mendonça França\nRemove deprecated\nTestFixtures.fixture_path\n.\nRafael Mendonça França\nRemove deprecated behavior to support referring to a singular association by its plural name.\nRafael Mendonça França\nDeprecate\nRails.application.config.active_record.allow_deprecated_singular_associations_name\n.\nRafael Mendonça França\nRemove deprecated support to passing\nSchemaMigration\nand\nInternalMetadata\nclasses as arguments to\nActiveRecord::MigrationContext\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Migration.check_pending!\nmethod.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::LogSubscriber.runtime\nmethod.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::LogSubscriber.runtime=\nmethod.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::LogSubscriber.reset_runtime\nmethod.\nRafael Mendonça França\nRemove deprecated support to define\nexplain\nin the connection adapter with 2 arguments.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::ActiveJobRequiredError\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.clear_active_connections!\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.clear_reloadable_connections!\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.clear_all_connections!\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.flush_idle_connections!\n.\nRafael Mendonça França\nRemove deprecated\nname\nargument from\nActiveRecord::Base.remove_connection\n.\nRafael Mendonça França\nRemove deprecated support to call\nalias_attribute\nwith non-existent attribute names.\nRafael Mendonça França\nRemove deprecated\nRails.application.config.active_record.suppress_multiple_database_warning\n.\nRafael Mendonça França\nAdd\nActiveRecord::Encryption::MessagePackMessageSerializer\n.\nSerialize data to the MessagePack format, for efficient storage in binary columns.\nThe binary encoding requires around 30% less space than the base64 encoding\nused by the default serializer.\nDonal McBreen\nAdd support for encrypting binary columns.\nEnsure encryption and decryption pass\nType::Binary::Data\naround for binary data.\nPreviously encrypting binary columns with the\nActiveRecord::Encryption::MessageSerializer\nincidentally worked for MySQL and SQLite, but not PostgreSQL.\nDonal McBreen\nDeprecated\nENV[\"SCHEMA_CACHE\"]\nin favor of\nschema_cache_path\nin the database configuration.\nRafael Mendonça França\nAdd\nActiveRecord::Base.with_connection\nas a shortcut for leasing a connection for a short duration.\nThe leased connection is yielded, and for the duration of the block, any call to\nActiveRecord::Base.connection\nwill yield that same connection.\nThis is useful to perform a few database operations without causing a connection to be leased for the\nentire duration of the request or job.\nJean Boussier\nDeprecate\nconfig.active_record.warn_on_records_fetched_greater_than\nnow that\nsql.active_record\nnotification includes\n:row_count\nfield.\nJason Nochlin\nThe fix ensures that the association is joined using the appropriate join type\n(either inner join or left outer join) based on the existing joins in the scope.\nThis prevents unintentional overrides of existing join types and ensures consistency in the generated SQL queries.\nExample:\n# `associated` will use `LEFT JOIN` instead of using `JOIN`\nPost\n.\nleft_joins\n(\n:author\n)\n.\nwhere\n.\nassociated\n(\n:author\n)\nSaleh Alhaddad\nFix an issue where\nActiveRecord::Encryption\nconfigurations are not ready before the loading\nof Active Record models, when an application is eager loaded. As a result, encrypted attributes\ncould be misconfigured in some cases.\nMaxime Réty\nDeprecate defining an\nenum\nwith keyword arguments.\nclass\nFunction\n>\nApplicationRecord\n# BAD\nenum\ncolor\n:\n[\n:red\n,\n:blue\n]\n,\ntype\n:\n[\n:instance\n,\n:class\n]\n# GOOD\nenum\n:color\n,\n[\n:red\n,\n:blue\n]\nenum\n:type\n,\n[\n:instance\n,\n:class\n]\nend\nHartley McGuire\nAdd\nconfig.active_record.validate_migration_timestamps\noption for validating migration timestamps.\nWhen set, validates that the timestamp prefix for a migration is no more than a day ahead of\nthe timestamp associated with the current time. This is designed to prevent migrations prefixes\nfrom being hand-edited to future timestamps, which impacts migration generation and other\nmigration commands.\nAdrianna Chang\nProperly synchronize\nMysql2Adapter#active?\nand\nTrilogyAdapter#active?\n.\nAs well as\ndisconnect!\nand\nverify!\n.\nThis generally isn't a big problem as connections must not be shared between\nthreads, but is required when running transactional tests or system tests\nand could lead to a SEGV.\nJean Boussier\nSupport\n:source_location\ntag option for query log tags.\nconfig\n.\nactive_record\n.\nquery_log_tags\n<<\n:source_location\nCalculating the caller location is a costly operation and should be used primarily in development\n(note, there is also a\nconfig.active_record.verbose_query_logs\nthat serves the same purpose)\nor occasionally on production for debugging purposes.\nfatkodima\nAdd an option to\nActiveRecord::Encryption::Encryptor\nto disable compression.\nAllow compression to be disabled by setting\ncompress: false\nclass\nUser\nencrypts\n:name\n,\nencryptor\n:\nActiveRecord\n::\nEncryption\n::\nEncryptor\n.\nnew\n(\ncompress\n:\nfalse\n)\nend\nDonal McBreen\nDeprecate passing strings to\nActiveRecord::Tasks::DatabaseTasks.cache_dump_filename\n.\nA\nActiveRecord::DatabaseConfigurations::DatabaseConfig\nobject should be passed instead.\nRafael Mendonça França\nAdd\nrow_count\nfield to\nsql.active_record\nnotification.\nThis field returns the amount of rows returned by the query that emitted the notification.\nThis metric is useful in cases where one wants to detect queries with big result sets.\nMarvin Bitterlich\nConsistently raise an\nArgumentError\nwhen passing an invalid argument to a nested attributes association writer.\nPreviously, this would only raise on collection associations and produce a generic error on singular associations.\nNow, it will raise on both collection and singular associations.\nJoshua Young\nFix single quote escapes on default generated MySQL columns.\nMySQL 5.7.5+ supports generated columns, which can be used to create a column that is computed from an expression.\nPreviously, the schema dump would output a string with double escapes for generated columns with single quotes in the default expression.\nThis would result in issues when importing the schema on a fresh instance of a MySQL database.\nNow, the string will not be escaped and will be valid Ruby upon importing of the schema.\nYash Kapadia\nFix Migrations with versions older than 7.1 validating options given to\nadd_reference\nand\nt.references\n.\nHartley McGuire\nAdd\n<role>_types\nclass method to\nActiveRecord::DelegatedType\nso that the delegated types can be introspected.\nJP Rosevear\nMake\nschema_dump\n,\nquery_cache\n,\nreplica\nand\ndatabase_tasks\nconfigurable via\nDATABASE_URL\n.\nThis wouldn't always work previously because boolean values would be interpreted as strings.\ne.g.\nDATABASE_URL=postgres://localhost/foo?schema_dump=false\nnow properly disable dumping the schema\ncache.\nMike Coutermarsh\n,\nJean Boussier\nIntroduce\nActiveRecord::Transactions::ClassMethods#set_callback\n.\nIt is identical to\nActiveSupport::Callbacks::ClassMethods#set_callback\nbut with support for\nafter_commit\nand\nafter_rollback\ncallback options.\nJoshua Young\nMake\nActiveRecord::Encryption::Encryptor\nagnostic of the serialization format used for encrypted data.\nPreviously, the encryptor instance only allowed an encrypted value serialized as a\nString\nto be passed to the message serializer.\nNow, the encryptor lets the configured\nmessage_serializer\ndecide which types of serialized encrypted values are supported. A custom serialiser is therefore allowed to serialize\nActiveRecord::Encryption::Message\nobjects using a type other than\nString\n.\nThe default\nActiveRecord::Encryption::MessageSerializer\nalready ensures that only\nString\nobjects are passed for deserialization.\nMaxime Réty\nFix\nencrypted_attribute?\nto take into account context properties passed to\nencrypts\n.\nMaxime Réty\nThe object returned by\nexplain\nnow responds to\npluck\n,\nfirst\n,\nlast\n,\naverage\n,\ncount\n,\nmaximum\n,\nminimum\n, and\nsum\n. Those\nnew methods run\nEXPLAIN\non the corresponding queries:\nUser\n.\nall\n.\nexplain\n.\ncount\n# EXPLAIN SELECT COUNT(*) FROM `users`\n# ...\nUser\n.\nall\n.\nexplain\n.\nmaximum\n(\n:id\n)\n# EXPLAIN SELECT MAX(`users`.`id`) FROM `users`\n# ...\nPetrik de Heus\nFixes an issue where\nvalidates_associated\n:on\noption wasn't respected\nwhen validating associated records.\nAusten Madden\n,\nAlex Ghiculescu\n,\nRafał Brize\nAllow overriding SQLite defaults from\ndatabase.yml\n.\nAny PRAGMA configuration set under the\npragmas\nkey in the configuration\nfile takes precedence over Rails' defaults, and additional PRAGMAs can be\nset as well.\ndatabase\n:\nstorage/development.sqlite3\ntimeout\n:\n5000\npragmas\n:\njournal_mode\n:\noff\ntemp_store\n:\nmemory\nStephen Margheim\nRemove warning message when running SQLite in production, but leave it unconfigured.\nThere are valid use cases for running SQLite in production. However, it must be done\nwith care, so instead of a warning most users won't see anyway, it's preferable to\nleave the configuration commented out to force them to think about having the database\non a persistent volume etc.\nJacopo Beschi\n,\nJean Boussier\nAdd support for generated columns to the SQLite3 adapter.\nGenerated columns (both stored and dynamic) are supported since version 3.31.0 of SQLite.\nThis adds support for those to the SQLite3 adapter.\ncreate_table\n:users\ndo\n|\nt\n|\nt\n.\nstring\n:name\nt\n.\nvirtual\n:name_upper\n,\ntype\n:\n:string\n,\nas\n:\n'UPPER(name)'\nt\n.\nvirtual\n:name_lower\n,\ntype\n:\n:string\n,\nas\n:\n'LOWER(name)'\n,\nstored\n:\ntrue\nend\nStephen Margheim\nTrilogyAdapter: ignore\nhost\nif\nsocket\nparameter is set.\nThis allows to configure a connection on a UNIX socket via\nDATABASE_URL\n:\nDATABASE_URL=trilogy://does-not-matter/my_db_production?socket=/var/run/mysql.sock\nJean Boussier\nMake\nassert_queries_count\n,\nassert_no_queries\n,\nassert_queries_match\n, and\nassert_no_queries_match\nassertions public.\nTo assert the expected number of queries are made, Rails internally uses\nassert_queries_count\nand\nassert_no_queries\n. To assert that specific SQL queries are made,\nassert_queries_match\nand\nassert_no_queries_match\nare used. These assertions can now be used in applications as well.\nclass\nArticleTest\n<\nActiveSupport\n::\nTestCase\ntest\n\"queries are made\"\ndo\nassert_queries_count\n(\n1\n)\n{\nArticle\n.\nfirst\n}\nend\ntest\n\"creates a foreign key\"\ndo\nassert_queries_match\n(\n/ADD FOREIGN KEY/i\n,\ninclude_schema\n:\ntrue\n)\ndo\n@connection\n.\nadd_foreign_key\n(\n:comments\n,\n:posts\n)\nend\nend\nend\nPetrik de Heus\n,\nfatkodima\nFix\nhas_secure_token\ncalls the setter method on initialize.\nAbeid Ahmed\nWhen using a\nDATABASE_URL\n, allow for a configuration to map the protocol in the URL to a specific database\nadapter. This allows decoupling the adapter the application chooses to use from the database connection details\nset in the deployment environment.\n# ENV['DATABASE_URL'] = \"mysql://localhost/example_database\"\nconfig\n.\nactive_record\n.\nprotocol_adapters\n.\nmysql\n=\n\"trilogy\"\n# will connect to MySQL using the trilogy adapter\nJean Boussier\n,\nKevin McPhillips\nIn cases where MySQL returns\nwarning_count\ngreater than zero, but returns no warnings when\nthe\nSHOW WARNINGS\nquery is executed,\nActiveRecord.db_warnings_action\nproc will still be\ncalled with a generic warning message rather than silently ignoring the warning(s).\nKevin McPhillips\nDatabaseConfigurations#configs_for\naccepts a symbol in the\nname\nparameter.\nAndrew Novoselac\nFix\nwhere(field: values)\nqueries when\nfield\nis a serialized attribute\n(for example, when\nfield\nuses\nActiveRecord::Base.serialize\nor is a JSON\ncolumn).\nJoão Alves\nMake the output of\nActiveRecord::Core#inspect\nconfigurable.\nBy default, calling\ninspect\non a record will yield a formatted string including just the\nid\n.\nPost\n.\nfirst\n.\ninspect\n#=> \"#<Post id: 1>\"\nThe attributes to be included in the output of\ninspect\ncan be configured with\nActiveRecord::Core#attributes_for_inspect\n.\nPost\n.\nattributes_for_inspect\n=\n[\n:id\n,\n:title\n]\nPost\n.\nfirst\n.\ninspect\n#=> \"#<Post id: 1, title: \"Hello, World!\">\"\nWith\nattributes_for_inspect\nset to\n:all\n,\ninspect\nwill list all the record's attributes.\nPost\n.\nattributes_for_inspect\n=\n:all\nPost\n.\nfirst\n.\ninspect\n#=> \"#<Post id: 1, title: \"Hello, World!\", published_at: \"2023-10-23 14:28:11 +0000\">\"\nIn\ndevelopment\nand\ntest\nmode,\nattributes_for_inspect\nwill be set to\n:all\nby default.\nYou can also call\nfull_inspect\nto get an inspection with all the attributes.\nThe attributes in\nattribute_for_inspect\nwill also be used for\npretty_print\n.\nAndrew Novoselac\nDon't mark attributes as changed when reassigned to\nFloat::INFINITY\nor\n-Float::INFINITY\n.\nMaicol Bentancor\nSupport the\nRETURNING\nclause for MariaDB.\nfatkodima\n,\nNikolay Kondratyev\nThe SQLite3 adapter now implements the\nsupports_deferrable_constraints?\ncontract.\nAllows foreign keys to be deferred by adding the\n:deferrable\nkey to the\nforeign_key\noptions.\nadd_reference\n:person\n,\n:alias\n,\nforeign_key\n:\n{\ndeferrable\n:\n:deferred\n}\nadd_reference\n:alias\n,\n:person\n,\nforeign_key\n:\n{\ndeferrable\n:\n:deferred\n}\nStephen Margheim\nAdd the\nset_constraints\nhelper to PostgreSQL connections.\nPost\n.\ncreate!\n(\nuser_id\n: -\n1\n)\n# => ActiveRecord::InvalidForeignKey\nPost\n.\ntransaction\ndo\nPost\n.\nconnection\n.\nset_constraints\n(\n:deferred\n)\np\n=\nPost\n.\ncreate!\n(\nuser_id\n: -\n1\n)\nu\n=\nUser\n.\ncreate!\np\n.\nuser\n=\nu\np\n.\nsave!\nend\nCody Cutrer\nInclude\nActiveModel::API\nin\nActiveRecord::Base\n.\nSean Doyle\nEnsure\n#signed_id\noutputs\nurl_safe\nstrings.\nJason Meller\nAdd\nnulls_last\nand working\ndesc.nulls_first\nfor MySQL.\nTristan Fellows\nAllow for more complex hash arguments for\norder\nwhich mimics\nwhere\nin\nActiveRecord::Relation\n.\nTopic\n.\nincludes\n(\n:posts\n)\n.\norder\n(\nposts\n:\n{\ncreated_at\n:\n:desc\n}\n)\nMyles Boone\nAction View\nFix templates with strict locals to also include\nlocal_assigns\n.\nPreviously templates defining strict locals wouldn't receive the\nlocal_assigns\nhash.\nJean Boussier\nAdd queries count to template rendering instrumentation.\n# Before\nCompleted 200 OK in 3804ms (Views: 41.0ms | ActiveRecord: 33.5ms | Allocations: 112788)\n\n# After\nCompleted 200 OK in 3804ms (Views: 41.0ms | ActiveRecord: 33.5ms (2 queries, 1 cached) | Allocations: 112788)\nfatkodima\nRaise\nArgumentError\nif\n:renderable\nobject does not respond to\n#render_in\n.\nSean Doyle\nAdd the\nnonce: true\noption for\nstylesheet_link_tag\nhelper to support automatic nonce generation for Content Security Policy.\nWorks the same way as\njavascript_include_tag nonce: true\ndoes.\nAkhil G Krishnan\n,\nAJ Esler\nParse\nActionView::TestCase#rendered\nHTML content as\nNokogiri::XML::DocumentFragment\ninstead of\nNokogiri::XML::Document\n.\nSean Doyle\nRename\nActionView::TestCase::Behavior::Content\nto\nActionView::TestCase::Behavior::RenderedViewContent\n.\nMake\nRenderedViewContent\ninherit from\nString\n. Make private API with\n:nodoc:\nSean Doyle\nDeprecate passing\nnil\nas value for the\nmodel:\nargument to the\nform_with\nmethod.\nCollin Jilbert\nAlias\nfield_set_tag\nhelper to\nfieldset_tag\nto match\n<fieldset>\nelement.\nSean Doyle\nDeprecate passing content to void elements when using\ntag.br\ntype tag builders.\nHartley McGuire\nFix the\nnumber_to_human_size\nview helper to correctly work with negative numbers.\nEarlopain\nAutomatically discard the implicit locals injected by collection rendering for template that can't accept them.\nWhen rendering a collection, two implicit variables are injected, which breaks templates with strict locals.\nNow they are only passed if the template will actually accept them.\nYasha Krasnou\n,\nJean Boussier\nFix\n@rails/ujs\ncalling\nstart()\nan extra time when using bundlers.\nHartley McGuire\n,\nRyunosuke Sato\nFix the\ncapture\nview helper compatibility with HAML and Slim.\nWhen a blank string was captured in HAML or Slim (and possibly other template engines)\nit would instead return the entire buffer.\nJean Boussier\nUpdated\n@rails/ujs\nfiles to ignore certain data-* attributes when element is contenteditable.\nThis fix was already landed in >= 7.0.4.3, < 7.1.0.\n[\nCVE-2023-23913\n]\nRyunosuke Sato\nAdded validation for HTML tag names in the\ntag\nand\ncontent_tag\nhelper method.\nThe\ntag\nand\ncontent_tag\nmethod now checks that the provided tag name adheres to the HTML\nspecification. If an invalid HTML tag name is provided, the method raises an\nArgumentError\nwith an appropriate error message.\nExamples:\n# Raises ArgumentError: Invalid HTML5 tag name: 12p\ncontent_tag\n(\n\"12p\"\n)\n# Starting with a number\n# Raises ArgumentError: Invalid HTML5 tag name: \"\"\ncontent_tag\n(\n\"\"\n)\n# Empty tag name\n# Raises ArgumentError: Invalid HTML5 tag name: div/\ntag\n(\n\"div/\"\n)\n# Contains a solidus\n# Raises ArgumentError: Invalid HTML5 tag name: \"image file\"\ntag\n(\n\"image file\"\n)\n# Contains a space\nAkhil G Krishnan\nAction Pack\nAllow bots to ignore\nallow_browser\n.\nMatthew Nguyen\nInclude the HTTP Permissions-Policy on non-HTML Content-Types\n[\nCVE-2024-28103\n]\nAaron Patterson\n,\nZack Deveau\nFix\nMime::Type.parse\nhandling type parameters for HTTP Accept headers.\nTaylor Chaparro\nFix the error page that is displayed when a view template is missing to account for nested controller paths in the\nsuggested correct location for the missing template.\nJoshua Young\nAdd\nsave_and_open_page\nhelper to\nIntegrationTest\n.\nsave_and_open_page\nis a helpful helper to keep a short feedback loop when working on system tests.\nA similar helper with matching signature has been added to integration tests.\nJoé Dupuis\nFix a regression in 7.1.3 passing a\nto:\noption without a controller when the controller is already defined by a scope.\nRails\n.\napplication\n.\nroutes\n.\ndraw\ndo\ncontroller\n:home\ndo\nget\n\"recent\"\n,\nto\n:\n\"recent_posts\"\nend\nend\nÉtienne Barrié\nRequest Forgery takes relative paths into account.\nStefan Wienert\nAdd \".test\" as a default allowed host in development to ensure smooth golden-path setup with puma.dev.\nDHH\nAdd\nallow_browser\nto set minimum browser versions for the application.\nA browser that's blocked will by default be served the file in\npublic/406-unsupported-browser.html\nwith a HTTP status code of \"406 Not Acceptable\".\nclass\nApplicationController\n<\nActionController\n::\nBase\n# Allow only browsers natively supporting webp images, web push, badges, import maps, CSS nesting + :has\nallow_browser\nversions\n:\n:modern\nend\nclass\nApplicationController\n<\nActionController\n::\nBase\n# All versions of Chrome and Opera will be allowed, but no versions of \"internet explorer\" (ie). Safari needs to be 16.4+ and Firefox 121+.\nallow_browser\nversions\n:\n{\nsafari\n:\n16.4\n,\nfirefox\n:\n121\n,\nie\n:\nfalse\n}\nend\nclass\nMessagesController\n<\nApplicationController\n# In addition to the browsers blocked by ApplicationController, also block Opera below 104 and Chrome below 119 for the show action.\nallow_browser\nversions\n:\n{\nopera\n:\n104\n,\nchrome\n:\n119\n}\n,\nonly\n:\n:show\nend\nDHH\nAdd rate limiting API.\nclass\nSessionsController\n<\nApplicationController\nrate_limit\nto\n:\n10\n,\nwithin\n:\n3\n.\nminutes\n,\nonly\n:\n:create\nend\nclass\nSignupsController\n<\nApplicationController\nrate_limit\nto\n:\n1000\n,\nwithin\n:\n10\n.\nseconds\n,\nby\n:\n->\n{\nrequest\n.\ndomain\n}\n,\nwith\n:\n->\n{\nredirect_to\nbusy_controller_url\n,\nalert\n:\n\"Too many signups!\"\n}\n,\nonly\n:\n:new\nend\nDHH\n,\nJean Boussier\nAdd\nimage/svg+xml\nto the compressible content types of\nActionDispatch::Static\n.\nGeorg Ledermann\nAdd instrumentation for\nActionController::Live#send_stream\n.\nAllows subscribing to\nsend_stream\nevents. The event payload contains the filename, disposition, and type.\nHannah Ramadan\nAdd support for\nwith_routing\ntest helper in\nActionDispatch::IntegrationTest\n.\nGannon McGibbon\nRemove deprecated support to set\nRails.application.config.action_dispatch.show_exceptions\nto\ntrue\nand\nfalse\n.\nRafael Mendonça França\nRemove deprecated\nspeaker\n,\nvibrate\n, and\nvr\npermissions policy directives.\nRafael Mendonça França\nRemove deprecated\nRails.application.config.action_dispatch.return_only_request_media_type_on_content_type\n.\nRafael Mendonça França\nDeprecate\nRails.application.config.action_controller.allow_deprecated_parameters_hash_equality\n.\nRafael Mendonça França\nRemove deprecated comparison between\nActionController::Parameters\nand\nHash\n.\nRafael Mendonça França\nRemove deprecated constant\nAbstractController::Helpers::MissingHelperError\n.\nRafael Mendonça França\nFix a race condition that could cause a\nText file busy - chromedriver\nerror with parallel system tests.\nMatt Brictson\nAdd\nracc\nas a dependency since it will become a bundled gem in Ruby 3.4.0\nHartley McGuire\nRemove deprecated constant\nActionDispatch::IllegalStateError\n.\nRafael Mendonça França\nAdd parameter filter capability for redirect locations.\nIt uses the\nconfig.filter_parameters\nto match what needs to be filtered.\nThe result would be like this:\nRedirected to http://secret.foo.bar?username=roque&password=[FILTERED]\nFixes\n#14055\n.\nRoque Pinel\n,\nTrevor Turk\n,\ntonytonyjan\nActive Job\nAll tests now respect the\nactive_job.queue_adapter\nconfig.\nPreviously if you had set\nconfig.active_job.queue_adapter\nin your\nconfig/application.rb\nor\nconfig/environments/test.rb\nfile, the adapter you selected was previously not used consistently\nacross all tests. In some tests your adapter would be used, but other tests would use the\nTestAdapter\n.\nIn Rails 7.2, all tests will respect the\nqueue_adapter\nconfig if provided. If no config is provided,\nthe\nTestAdapter\nwill continue to be used.\nSee\n#48585\nfor more details.\nAlex Ghiculescu\nMake Active Job transaction aware when used conjointly with Active Record.\nA common mistake with Active Job is to enqueue jobs from inside a transaction,\ncausing them to potentially be picked and ran by another process, before the\ntransaction is committed, which may result in various errors.\nTopic\n.\ntransaction\ndo\ntopic\n=\nTopic\n.\ncreate\n(\n...\n)\nNewTopicNotificationJob\n.\nperform_later\n(\ntopic\n)\nend\nNow Active Job will automatically defer the enqueuing to after the transaction is committed,\nand drop the job if the transaction is rolled back.\nVarious queue implementations can choose to disable this behavior, and users can disable it,\nor force it on a per job basis:\nclass\nNewTopicNotificationJob\n<\nApplicationJob\nself\n.\nenqueue_after_transaction_commit\n=\n:never\n# or `:always` or `:default`\nend\nJean Boussier\n,\nCristian Bica\nDo not trigger immediate loading of\nActiveJob::Base\nwhen loading\nActiveJob::TestHelper\n.\nMaxime Réty\nPreserve the serialized timezone when deserializing\nActiveSupport::TimeWithZone\narguments.\nJoshua Young\nRemove deprecated\n:exponentially_longer\nvalue for the\n:wait\nin\nretry_on\n.\nRafael Mendonça França\nRemove deprecated support to set numeric values to\nscheduled_at\nattribute.\nRafael Mendonça França\nDeprecate\nRails.application.config.active_job.use_big_decimal_serialize\n.\nRafael Mendonça França\nRemove deprecated primitive serializer for\nBigDecimal\narguments.\nRafael Mendonça França\nAction Mailer\nRemove deprecated params via\n:args\nfor\nassert_enqueued_email_with\n.\nRafael Mendonça França\nRemove deprecated\nconfig.action_mailer.preview_path\n.\nRafael Mendonça França\nAction Cable\nBring\nActionCable::Connection::TestCookieJar\nin alignment with\nActionDispatch::Cookies::CookieJar\nin regards to setting the cookie value.\nBefore:\ncookies\n[\n:foo\n]\n=\n{\nvalue\n:\n\"bar\"\n}\nputs\ncookies\n[\n:foo\n]\n# => { value: \"bar\" }\nAfter:\ncookies\n[\n:foo\n]\n=\n{\nvalue\n:\n\"bar\"\n}\nputs\ncookies\n[\n:foo\n]\n# => \"bar\"\nJustin Ko\nRecord ping on every Action Cable message.\nPreviously only\nping\nand\nwelcome\nmessage types were keeping the connection active.\nNow every Action Cable message updates the\npingedAt\nvalue, preventing the connection\nfrom being marked as stale.\nyauhenininjia\nAdd two new assertion methods for Action Cable test cases:\nassert_has_no_stream\nand\nassert_has_no_stream_for\n.\nThese methods can be used to assert that a stream has been stopped, e.g. via\nstop_stream\nor\nstop_stream_for\n. They complement the already existing\nassert_has_stream\nand\nassert_has_stream_for\nmethods.\nassert_has_no_stream\n\"messages\"\nassert_has_no_stream_for\nUser\n.\nfind\n(\n42\n)\nSebastian Pöll\n,\nJunichi Sato\nActive Storage\nRemove deprecated\nconfig.active_storage.silence_invalid_content_types_warning\n.\nRafael Mendonça França\nRemove deprecated\nconfig.active_storage.replace_on_assign_to_many\n.\nRafael Mendonça França\nAdd support for custom\nkey\nin\nActiveStorage::Blob#compose\n.\nElvin Efendiev\nAdd\nimage/webp\nto\nconfig.active_storage.web_image_content_types\nwhen\nload_defaults \"7.2\"\nis set.\nLewis Buckley\nFix JSON-encoding of\nActiveStorage::Filename\ninstances.\nJonathan del Strother\nFix N+1 query when fetching preview images for non-image assets.\nAaron Patterson & Justin Searls\nFix all Active Storage database related models to respect\nActiveRecord::Base.table_name_prefix\nconfiguration.\nChedli Bourguiba\nFix\nActiveStorage::Representations::ProxyController\nnot returning the proper\npreview image variant for previewable files.\nChedli Bourguiba\nFix\nActiveStorage::Representations::ProxyController\nto proxy untracked\nvariants.\nChedli Bourguiba\nWhen using the\npreprocessed: true\noption, avoid enqueuing transform jobs\nfor blobs that are not representable.\nChedli Bourguiba\nPrevent\nActiveStorage::Blob#preview\nto generate a variant if an empty variation is passed.\nCalls to\n#url\n,\n#key\nor\n#download\nwill now use the original preview\nimage instead of generating a variant with the exact same dimensions.\nChedli Bourguiba\nProcess preview image variant when calling\nActiveStorage::Preview#processed\n.\nFor example,\nattached_pdf.preview(:thumb).processed\nwill now immediately\ngenerate the full-sized preview image and the\n:thumb\nvariant of it.\nPreviously, the\n:thumb\nvariant would not be generated until a further call\nto e.g.\nprocessed.url\n.\nChedli Bourguiba\nand\nJonathan Hefner\nPrevent\nActiveRecord::StrictLoadingViolationError\nwhen strict loading is\nenabled and the variant of an Active Storage preview has already been\nprocessed (for example, by calling\nActiveStorage::Preview#url\n).\nJonathan Hefner\nFix\npreprocessed: true\noption for named variants of previewable files.\nNico Wenterodt\nAllow accepting\nservice\nas a proc as well in\nhas_one_attached\nand\nhas_many_attached\n.\nYogesh Khater\nAction Mailbox\nFix all Action Mailbox database related models to respect\nActiveRecord::Base.table_name_prefix\nconfiguration.\nChedli Bourguiba\nAction Text\nOnly sanitize\ncontent\nattribute when present in attachments.\nPetrik de Heus\nSanitize ActionText HTML ContentAttachment in Trix edit view\n[\nCVE-2024-32464\n]\nAaron Patterson\n,\nZack Deveau\nUse\nincludes\ninstead of\neager_load\nfor\nwith_all_rich_text\n.\nPetrik de Heus\nDelegate\nActionText::Content#deconstruct\nto\nNokogiri::XML::DocumentFragment#elements\n.\ncontent\n=\nActionText\n::\nContent\n.\nnew\n<<~HTML\n<\nh1\n>\nHello, world\n</\nh1\n>\n<\ndiv\n>\nThe body\n</\ndiv\n>\nHTML\ncontent\n=>\n[\nh1\n,\ndiv\n]\nassert_pattern\n{\nh1\n=>\n{\ncontent\n:\n\"Hello, world\"\n}\n}\nassert_pattern\n{\ndiv\n=>\n{\ncontent\n:\n\"The body\"\n}\n}\nSean Doyle\nFix all Action Text database related models to respect\nActiveRecord::Base.table_name_prefix\nconfiguration.\nChedli Bourguiba\nCompile ESM package that can be used directly in the browser as actiontext.esm.js\nMatias Grunberg\nFix using actiontext.js with Sprockets.\nMatias Grunberg\nUpgrade Trix to 2.0.7\nHartley McGuire\nFix using Trix with Sprockets.\nHartley McGuire\nRailties\nThe new\nbin/rails boot\ncommand boots the application and exits. Supports the\nstandard\n-e/--environment\noptions.\nXavier Noria\nCreate a Dev Container Generator that generates a Dev Container setup based on the current configuration\nof the application. Usage:\nbin/rails devcontainer\nAndrew Novoselac\nAdd Rubocop and GitHub Actions to plugin generator.\nThis can be skipped using --skip-rubocop and --skip-ci.\nChris Oliver\nRemove support for\noracle\n,\nsqlserver\nand JRuby specific database adapters from the\nrails new\nand\nrails db:system:change\ncommands.\nThe supported options are\nsqlite3\n,\nmysql\n,\npostgresql\nand\ntrilogy\n.\nAndrew Novoselac\nAdd options to\nbin/rails app:update\n.\nbin/rails app:update\nnow supports the same generic options that generators do:\n--force\n: Accept all changes to existing files\n--skip\n: Refuse all changes to existing files\n--pretend\n: Don't make any changes\n--quiet\n: Don't output all changes made\nÉtienne Barrié\nImplement Rails console commands and helpers with IRB v1.13's extension APIs.\nRails console users will now see\nhelper\n,\ncontroller\n,\nnew_session\n, and\napp\nunder\nIRB help message's\nHelper methods\ncategory. And\nreload!\ncommand will be displayed under\nthe new\nRails console\ncommands category.\nPrior to this change, Rails console's commands and helper methods are added through IRB's\nprivate components and don't show up in its help message, which led to poor discoverability.\nStan Lo\nRemove deprecated\nRails::Generators::Testing::Behaviour\n.\nRafael Mendonça França\nRemove deprecated\nfind_cmd_and_exec\nconsole helper.\nRafael Mendonça França\nRemove deprecated\nRails.config.enable_dependency_loading\n.\nRafael Mendonça França\nRemove deprecated\nRails.application.secrets\n.\nRafael Mendonça França\nGenerated Gemfile will include\nrequire: \"debug/prelude\"\nfor the\ndebug\ngem.\nRequiring\ndebug\ngem directly automatically activates it, which could introduce\nadditional overhead and memory usage even without entering a debugging session.\nBy making Bundler require\ndebug/prelude\ninstead, developers can keep their access\nto breakpoint methods like\ndebugger\nor\nbinding.break\n, but the debugger won't be\nactivated until a breakpoint is hit.\nStan Lo\nSkip generating a\ntest\njob in ci.yml when a new application is generated with the\n--skip-test\noption.\nSteve Polito\nUpdate the\n.node-version\nfile conditionally generated for new applications to 20.11.1\nSteve Polito\nFix sanitizer vendor configuration in 7.1 defaults.\nIn apps where rails-html-sanitizer was not eagerly loaded, the sanitizer default could end up\nbeing Rails::HTML4::Sanitizer when it should be set to Rails::HTML5::Sanitizer.\nMike Dalessio\n,\nRafael Mendonça França\nSet\naction_mailer.default_url_options\nvalues in\ndevelopment\nand\ntest\n.\nPrior to this commit, new Rails applications would raise\nActionView::Template::Error\nif a mailer included a url built with a\n*_path\nhelper.\nSteve Polito\nIntroduce\nRails::Generators::Testing::Assertions#assert_initializer\n.\nCompliments the existing\ninitializer\ngenerator action.\nassert_initializer\n\"mail_interceptors.rb\"\nSteve Polito\nGenerate a .devcontainer folder and its contents when creating a new app.\nThe .devcontainer folder includes everything needed to boot the app and do development in a remote container.\nThe container setup includes:\nA redis container for Kredis, ActionCable etc.\nA database (SQLite, Postgres, MySQL or MariaDB)\nA Headless chrome container for system tests\nActive Storage configured to use the local disk and with preview features working\nIf any of these options are skipped in the app setup they will not be included in the container configuration.\nThese files can be skipped using the\n--skip-devcontainer\noption.\nAndrew Novoselac & Rafael Mendonça França\nIntroduce\nSystemTestCase#served_by\nfor configuring the System Test application server.\nBy default this is localhost. This method allows the host and port to be specified manually.\nclass\nApplicationSystemTestCase\n<\nActionDispatch\n::\nSystemTestCase\nserved_by\nhost\n:\n\"testserver\"\n,\nport\n:\n45678\nend\nAndrew Novoselac & Rafael Mendonça França\nbin/rails test\nwill no longer load files named\n*_test.rb\nif they are located in the\nfixtures\nfolder.\nEdouard Chin\nEnsure logger tags configured with\nconfig.log_tags\nare still active in\nrequest.action_dispatch\nhandlers.\nKJ Tsanaktsidis\nSetup jemalloc in the default Dockerfile for memory optimization.\nMatt Almeida\n,\nJean Boussier\nCommented out lines in .railsrc file should not be treated as arguments when using\nrails new generator command. Update ARGVScrubber to ignore text after\n#\nsymbols.\nWillian Tenfen\nSkip CSS when generating APIs.\nRuy Rocha\nRails console now indicates application name and the current Rails environment:\nmy-app(dev)> # for RAILS_ENV=development\nmy-app(test)> # for RAILS_ENV=test\nmy-app(prod)> # for RAILS_ENV=production\nmy-app(my_env)> # for RAILS_ENV=my_env\nThe application name is derived from the application's module name from\nconfig/application.rb\n.\nFor example,\nMyApp\nwill displayed as\nmy-app\nin the prompt.\nAdditionally, the environment name will be colorized when the environment is\ndevelopment\n(blue),\ntest\n(blue), or\nproduction\n(red), if your\nterminal supports it.\nStan Lo\nEnsure\nautoload_paths\n,\nautoload_once_paths\n,\neager_load_paths\n, and\nload_paths\nonly have directories when initialized from engine defaults.\nPreviously, files under the\napp\ndirectory could end up there too.\nTakumasa Ochi\nPrevent unnecessary application reloads in development.\nPreviously, some files outside autoload paths triggered unnecessary reloads.\nWith this fix, application reloads according to\nRails.autoloaders.main.dirs\n,\nthereby preventing unnecessary reloads.\nTakumasa Ochi\nUse\noven-sh/setup-bun\nin GitHub CI when generating an app with Bun.\nTangRufus\nDisable\npidfile\ngeneration in the\nproduction\nenvironment.\nHans Schnedlitz\nSet\nconfig.action_view.annotate_rendered_view_with_filenames\nto\ntrue\nin\nthe\ndevelopment\nenvironment.\nAdrian Marin\nSupport the\nBACKTRACE\nenvironment variable to turn off backtrace cleaning.\nUseful for debugging framework code:\nBACKTRACE=1 bin/rails server\nAlex Ghiculescu\nRaise\nArgumentError\nwhen reading\nconfig.x.something\nwith arguments:\nconfig\n.\nx\n.\nthis_works\n.\nthis_raises\ntrue\n# raises ArgumentError\nSean Doyle\nAdd default PWA files for manifest and service-worker that are served from\napp/views/pwa\nand can be dynamically rendered through ERB. Mount these files explicitly at the root with default routes in the generated routes file.\nDHH\nUpdated system tests to now use headless Chrome by default for the new applications.\nDHH\nAdd GitHub CI files for Dependabot, Brakeman, RuboCop, and running tests by default. Can be skipped with\n--skip-ci\n.\nDHH\nAdd Brakeman by default for static analysis of security vulnerabilities. Allow skipping with\n--skip-brakeman option\n.\nvipulnsward\nAdd RuboCop with rules from\nrubocop-rails-omakase\nby default. Skip with\n--skip-rubocop\n.\nDHH\nand\nzzak\nUse\nbin/rails runner --skip-executor\nto not wrap the runner script with an\nExecutor.\nBen Sheldon\nFix isolated engines to take\nActiveRecord::Base.table_name_prefix\ninto consideration.\nThis will allow for engine defined models, such as inside Active Storage, to respect\nActive Record table name prefix configuration.\nChedli Bourguiba\nFix running\ndb:system:change\nwhen the app has no Dockerfile.\nHartley McGuire\nIn Action Mailer previews, list inline attachments separately from normal\nattachments.\nFor example, attachments that were previously listed like\nAttachments: logo.png file1.pdf file2.pdf\nwill now be listed like\nAttachments: file1.pdf file2.pdf (Inline: logo.png)\nChristian Schmidt\nand\nJonathan Hefner\nIn mailer preview, only show SMTP-To if it differs from the union of To, Cc and Bcc.\nChristian Schmidt\nEnable YJIT by default on new applications running Ruby 3.3+.\nThis can be disabled by setting\nRails.application.config.yjit = false\nJean Boussier\n,\nRafael Mendonça França\nIn Action Mailer previews, show date from message\nDate\nheader if present.\nSampat Badhe\nExit with non-zero status when the migration generator fails.\nKatsuhiko YOSHIDA\nUse numeric UID and GID in Dockerfile template.\nThe Dockerfile generated by\nrails new\nsets the default user and group\nby name instead of UID:GID. This can cause the following error in Kubernetes:\ncontainer has runAsNonRoot and image has non-numeric user (rails), cannot verify user is non-root\nThis change sets default user and group by their numeric values.\nIvan Fedotov\nDisallow invalid values for rails new options.\nThe\n--database\n,\n--asset-pipeline\n,\n--css\n, and\n--javascript\noptions\nfor\nrails new\ntake different arguments. This change validates them.\nTony Drake\n,\nAkhil G Krishnan\n,\nPetrik de Heus\nConditionally print\n$stdout\nwhen invoking\nrun_generator\n.\nIn an effort to improve the developer experience when debugging\ngenerator tests, we add the ability to conditionally print\n$stdout\ninstead of capturing it.\nThis allows for calls to\nbinding.irb\nand\nputs\nwork as expected.\nRAILS_LOG_TO_STDOUT=true ./bin/test test/generators/actions_test.rb\nSteve Polito\nRemove the option\nconfig.public_file_server.enabled\nfrom the generators\nfor all environments, as the value is the same in all environments.\nAdrian Hirt",
    "crawl_status": "success"
  },
  {
    "library_name": "Rails",
    "url": "https://github.com/rails/rails/releases/tag/v7.0.0",
    "version": "v7.0.0",
    "title": "Release 7.0.0 · rails/rails · GitHub",
    "release_date": "2021-12-16T00:26:06Z",
    "content": "Action Cable\nThe Action Cable client now ensures successful channel subscriptions:\nThe client maintains a set of pending subscriptions until either\nthe server confirms the subscription or the channel is torn down.\nRectifies the race condition where an unsubscribe is rapidly followed\nby a subscribe (on the same channel identifier) and the requests are\nhandled out of order by the ActionCable server, thereby ignoring the\nsubscribe command.\nDaniel Spinosa\nCompile ESM package that can be used directly in the browser as actioncable.esm.js.\nDHH\nMove action_cable.js to actioncable.js to match naming convention used for other Rails frameworks, and use JS console to communicate the deprecation.\nDHH\nStop transpiling the UMD package generated as actioncable.js and drop the IE11 testing that relied on that.\nDHH\nTruncate broadcast logging messages.\nJ Smith\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nThe Action Cable client now includes safeguards to prevent a \"thundering\nherd\" of client reconnects after server connectivity loss:\nThe client will wait a random amount between 1x and 3x of the stale\nthreshold after the server's last ping before making the first\nreconnection attempt.\nSubsequent reconnection attempts now use exponential backoff instead of\nlogarithmic backoff.  To allow the delay between reconnection attempts to\nincrease slowly at first, the default exponentiation base is < 2.\nRandom jitter is applied to each delay between reconnection attempts.\nJonathan Hefner\nAction Mailbox\nRemoved deprecated environment variable\nMAILGUN_INGRESS_API_KEY\n.\nRafael Mendonça França\nRemoved deprecated\nRails.application.credentials.action_mailbox.mailgun_api_key\n.\nRafael Mendonça França\nAdd\nattachments\nto the list of permitted parameters for inbound emails conductor.\nWhen using the conductor to test inbound emails with attachments, this prevents an\nunpermitted parameter warning in default configurations, and prevents errors for\napplications that set:\nconfig\n.\naction_controller\n.\naction_on_unpermitted_parameters\n=\n:raise\nDavid Jones\n,\nDana Henke\nAdd ability to configure ActiveStorage service\nfor storing email raw source.\n#\nconfig/storage.yml\nincoming_emails\n:\nservice\n:\nDisk\nroot\n:\n/secure/dir/for/emails/only\nconfig\n.\naction_mailbox\n.\nstorage_service\n=\n:incoming_emails\nYurii Rashkovskii\nAdd ability to incinerate an inbound message through the conductor interface.\nSantiago Bartesaghi\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nAction Mailer\nRemove deprecated\nActionMailer::DeliveryJob\nand\nActionMailer::Parameterized::DeliveryJob\nin favor of\nActionMailer::MailDeliveryJob\n.\nRafael Mendonça França\nemail_address_with_name\nreturns just the address if name is blank.\nThomas Hutterer\nConfigures a default of 5 for both\nopen_timeout\nand\nread_timeout\nfor SMTP Settings.\nAndré Luis Leal Cardoso Junior\nAction Pack\nDeprecate\nRails.application.config.action_controller.urlsafe_csrf_tokens\n. This config is now always enabled.\nÉtienne Barrié\nInstance variables set in requests in a\nActionController::TestCase\nare now cleared before the next request\nThis means if you make multiple requests in the same test, instance variables set in the first request will\nnot persist into the second one. (It's not recommended to make multiple requests in the same test.)\nAlex Ghiculescu\nRails.application.executor\nhooks can now be called around every request in a\nActionController::TestCase\nThis helps to better simulate request or job local state being reset between requests and prevent state\nleaking from one request to another.\nTo enable this, set\nconfig.active_support.executor_around_test_case = true\n(this is the default in Rails 7).\nAlex Ghiculescu\nConsider onion services secure for cookies.\nJustin Tracey\nRemove deprecated\nRails.config.action_view.raise_on_missing_translations\n.\nRafael Mendonça França\nRemove deprecated support to passing a path to\nfixture_file_upload\nrelative to\nfixture_path\n.\nRafael Mendonça França\nRemove deprecated\nActionDispatch::SystemTestCase#host!\n.\nRafael Mendonça França\nRemove deprecated\nRails.config.action_dispatch.hosts_response_app\n.\nRafael Mendonça França\nRemove deprecated\nActionDispatch::Response.return_only_media_type_on_content_type\n.\nRafael Mendonça França\nRaise\nActionController::Redirecting::UnsafeRedirectError\nfor unsafe\nredirect_to\nredirects.\nThis allows\nrescue_from\nto be used to add a default fallback route:\nrescue_from\nActionController\n::\nRedirecting\n::\nUnsafeRedirectError\ndo\nredirect_to\nroot_url\nend\nKasper Timm Hansen\n,\nChris Oliver\nAdd\nurl_from\nto verify a redirect location is internal.\nTakes the open redirect protection from\nredirect_to\nso users can wrap a\nparam, and fall back to an alternate redirect URL when the param provided\none is unsafe.\ndef\ncreate\nredirect_to\nurl_from\n(\nparams\n[\n:redirect_url\n]\n)\n||\nroot_url\nend\ndmcge\n,\nKasper Timm Hansen\nAllow Capybara driver name overrides in\nSystemTestCase::driven_by\nAllow users to prevent conflicts among drivers that use the same driver\ntype (selenium, poltergeist, webkit, rack test).\nFixes\n#42502\nChris LaRose\nAllow multiline to be passed in routes when using wildcard segments.\nPreviously routes with newlines weren't detected when using wildcard segments, returning\na\nNo route matches\nerror.\nAfter this change, routes with newlines are detected on wildcard segments. Example\ndraw\ndo\nget\n\"/wildcard/*wildcard_segment\"\n,\nto\n:\nSimpleApp\n.\nnew\n(\n\"foo#index\"\n)\n,\nas\n:\n:wildcard\nend\n# After the change, the path matches.\nassert_equal\n\"/wildcard/a%0Anewline\"\n,\nurl_helpers\n.\nwildcard_path\n(\nwildcard_segment\n:\n\"a\n\\n\nnewline\"\n)\nFixes\n#39103\nIgnacio Chiazzo\nTreat html suffix in controller translation.\nRui Onodera\n,\nGavin Miller\nAllow permitting numeric params.\nPreviously it was impossible to permit different fields on numeric parameters.\nAfter this change you can specify different fields for each numbered parameter.\nFor example params like,\nbook\n:\n{\nauthors_attributes\n:\n{\n'0'\n:\n{\nname\n:\n\"William Shakespeare\"\n,\nage_of_death\n:\n\"52\"\n}\n,\n'1'\n:\n{\nname\n:\n\"Unattributed Assistant\"\n}\n,\n'2'\n:\n\"Not a hash\"\n,\n'new_record'\n:\n{\nname\n:\n\"Some name\"\n}\n}\n}\nBefore you could permit name on each author with,\npermit book: { authors_attributes: [ :name ] }\nAfter this change you can permit different keys on each numbered element,\npermit book: { authors_attributes: { '1': [ :name ], '0': [ :name, :age_of_death ] } }\nFixes\n#41625\nAdam Hess\nUpdate\nHostAuthorization\nmiddleware to render debug info only\nwhen\nconfig.consider_all_requests_local\nis set to true.\nAlso, blocked host info is always logged with level\nerror\n.\nFixes\n#42813\nNikita Vyrko\nAdd Server-Timing middleware\nServer-Timing specification defines how the server can communicate to browsers performance metrics\nabout the request it is responding to.\nThe ServerTiming middleware is enabled by default on\ndevelopment\nenvironment by default using the\nconfig.server_timing\nsetting and set the relevant duration metrics in the\nServer-Timing\nheader\nThe full specification for Server-Timing header can be found in:\nhttps://www.w3.org/TR/server-timing/#dfn-server-timing-header-field\nSebastian Sogamoso\n,\nGuillermo Iguaran\nUse a static error message when raising\nActionDispatch::Http::Parameters::ParseError\nto avoid inadvertently logging the HTTP request body at the\nfatal\nlevel when it contains\nmalformed JSON.\nFixes\n#41145\nAaron Lahey\nAdd\nMiddleware#delete!\nto delete middleware or raise if not found.\nMiddleware#delete!\nworks just like\nMiddleware#delete\nbut will\nraise an error if the middleware isn't found.\nAlex Ghiculescu\n,\nPetrik de Heus\n,\nJunichi Sato\nRaise error on unpermitted open redirects.\nAdd\nallow_other_host\noptions to\nredirect_to\n.\nOpt in to this behaviour with\nActionController::Base.raise_on_open_redirects = true\n.\nGannon McGibbon\nDeprecate\npoltergeist\nand\nwebkit\n(capybara-webkit) driver registration for system testing (they will be removed in Rails 7.1). Add\ncuprite\ninstead.\nPoltergeist\nand\ncapybara-webkit\nare already not maintained. These usage in Rails are removed for avoiding confusing users.\nCuprite\nis a good alternative to Poltergeist. Some guide descriptions are replaced from Poltergeist to Cuprite.\nYusuke Iwaki\nExclude additional flash types from\nActionController::Base.action_methods\n.\nEnsures that additional flash types defined on ActionController::Base subclasses\nare not listed as actions on that controller.\nclass MyController < ApplicationController\n  add_flash_types :hype\nend\n\nMyController.action_methods.include?('hype') # => false\nGavin Morrice\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nRemove IE6-7-8 file download related hack/fix from ActionController::DataStreaming module.\nDue to the age of those versions of IE this fix is no longer relevant, more importantly it creates an edge-case for unexpected Cache-Control headers.\nTadas Sasnauskas\nConfiguration setting to skip logging an uncaught exception backtrace when the exception is\npresent in\nrescued_responses\n.\nIt may be too noisy to get all backtraces logged for applications that manage uncaught\nexceptions via\nrescued_responses\nand\nexceptions_app\n.\nconfig.action_dispatch.log_rescued_responses\n(defaults to\ntrue\n) can be set to\nfalse\nin\nthis case, so that only exceptions not found in\nrescued_responses\nwill be logged.\nAlexander Azarov\n,\nMike Dalessio\nIgnore file fixtures on\ndb:fixtures:load\n.\nKevin Sjöberg\nFix ActionController::Live controller test deadlocks by removing the body buffer size limit for tests.\nDylan Thacker-Smith\nNew\nActionController::ConditionalGet#no_store\nmethod to set HTTP cache control\nno-store\ndirective.\nTadas Sasnauskas\nDrop support for the\nSERVER_ADDR\nheader.\nFollowing up\nrack/rack#1573\nand\n#42349\n.\nRicardo Díaz\nSet session options when initializing a basic session.\nGannon McGibbon\nAdd\ncache_control: {}\noption to\nfresh_when\nand\nstale?\n.\nWorks as a shortcut to set\nresponse.cache_control\nwith the above methods.\nJacopo Beschi\nWriting into a disabled session will now raise an error.\nPreviously when no session store was set, writing into the session would silently fail.\nJean Boussier\nAdd support for 'require-trusted-types-for' and 'trusted-types' headers.\nFixes\n#42034\n.\nlfalcao\nRemove inline styles and address basic accessibility issues on rescue templates.\nJacob Herrington\nAdd support for 'private, no-store' Cache-Control headers.\nPreviously, 'no-store' was exclusive; no other directives could be specified.\nAlex Smith\nExpand payload of\nunpermitted_parameters.action_controller\ninstrumentation to allow subscribers to\nknow which controller action received unpermitted parameters.\nbbuchalter\nAdd\nActionController::Live#send_stream\nthat makes it more convenient to send generated streams:\nsend_stream\n(\nfilename\n:\n\"subscribers.csv\"\n)\ndo\n|\nstream\n|\nstream\n.\nwriteln\n\"email_address,updated_at\"\n@subscribers\n.\nfind_each\ndo\n|\nsubscriber\n|\nstream\n.\nwriteln\n[\nsubscriber\n.\nemail_address\n,\nsubscriber\n.\nupdated_at\n]\n.\njoin\n(\n\",\"\n)\nend\nend\nDHH\nAdd\nActionController::Live::Buffer#writeln\nto write a line to the stream with a newline included.\nDHH\nActionDispatch::Request#content_type\nnow returned Content-Type header as it is.\nPreviously,\nActionDispatch::Request#content_type\nreturned value does NOT contain charset part.\nThis behavior changed to returned Content-Type header containing charset part as it is.\nIf you want just MIME type, please use\nActionDispatch::Request#media_type\ninstead.\nBefore:\nrequest\n=\nActionDispatch\n::\nRequest\n.\nnew\n(\n\"CONTENT_TYPE\"\n=>\n\"text/csv; header=present; charset=utf-16\"\n,\n\"REQUEST_METHOD\"\n=>\n\"GET\"\n)\nrequest\n.\ncontent_type\n#=> \"text/csv\"\nAfter:\nrequest\n=\nActionDispatch\n::\nRequest\n.\nnew\n(\n\"Content-Type\"\n=>\n\"text/csv; header=present; charset=utf-16\"\n,\n\"REQUEST_METHOD\"\n=>\n\"GET\"\n)\nrequest\n.\ncontent_type\n#=> \"text/csv; header=present; charset=utf-16\"\nrequest\n.\nmedia_type\n#=> \"text/csv\"\nRafael Mendonça França\nChange\nActionDispatch::Request#media_type\nto return\nnil\nwhen the request don't have a\nContent-Type\nheader.\nRafael Mendonça França\nFix error in\nActionController::LogSubscriber\nthat would happen when throwing inside a controller action.\nJanko Marohnić\nAllow anything with\n#to_str\n(like\nAddressable::URI\n) as a\nredirect_to\nlocation.\nojab\nChange the request method to a\nGET\nwhen passing failed requests down to\nconfig.exceptions_app\n.\nAlex Robbin\nDeprecate the ability to assign a single value to\nconfig.action_dispatch.trusted_proxies\nas\nRemoteIp\nmiddleware behaves inconsistently depending on whether this is configured\nwith a single value or an enumerable.\nFixes\n#40772\n.\nChristian Sutter\nAdd\nredirect_back_or_to(fallback_location, **)\nas a more aesthetically pleasing version of\nredirect_back fallback_location:, **\n.\nThe old method name is retained without explicit deprecation.\nDHH\nAction Text\nFix an issue with how nested lists were displayed when converting to plain text\nMatt Swanson\nAllow passing in a custom\ndirect_upload_url\nor\nblob_url_template\nto\nrich_text_area_tag\n.\nLucas Mansur\nMake the Action Text + Trix JavaScript and CSS available through the asset pipeline.\nDHH\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nAdd support for passing\nform:\noption to\nrich_text_area_tag\nand\nrich_text_area\nhelpers to specify the\n<input type=\"hidden\" form=\"...\">\nvalue.\nSean Doyle\nAdd\nconfig.action_text.attachment_tag_name\n, to specify the HTML tag that contains attachments.\nMark VanLandingham\nExpose how we render the HTML\nsurrounding\nrich text content as an\nextensible\nlayouts/action_view/contents/_content.html.erb\ntemplate to\nencourage user-land customizations, while retaining private API control over how\nthe rich text itself is rendered by\naction_text/contents/_content.html.erb\npartial.\nSean Doyle\nAdd\nwith_all_rich_text\nmethod to eager load all rich text associations on a model at once.\nMatt Swanson\n,\nDHH\nAction View\nSupport\ninclude_hidden:\noption in calls to\nActionView::Helper::FormBuilder#file_field\nwith\nmultiple: true\nto\nsupport submitting an empty collection of files.\nform\n.\nfile_field\n:attachments\n,\nmultiple\n:\ntrue\n# => <input type=\"hidden\" autocomplete=\"off\" name=\"post[attachments][]\" value=\"\">\n<\ninput\ntype\n=\n\"file\"\nmultiple\n=\n\"multiple\"\nid\n=\n\"post_attachments\"\nname\n=\n\"post[attachments][]\"\n>\nform\n.\nfile_field\n:attachments\n,\nmultiple\n:\ntrue\n,\ninclude_hidden\n:\nfalse\n# => <input type=\"file\" multiple=\"multiple\" id=\"post_attachments\" name=\"post[attachments][]\">\nSean Doyle\nFix\nnumber_with_precision(raise: true)\nalways raising even on valid numbers.\nPedro Moreira\nSupport\nfields model: [@nested, @model]\nthe same way as\nform_with model: [@nested, @model]\n.\nSean Doyle\nInfer HTTP verb\n[method]\nfrom a model or Array with model as the first\nargument to\nbutton_to\nwhen combined with a block:\nbutton_to\n(\nWorkshop\n.\nfind\n(\n1\n)\n)\n{\n\"Update\"\n}\n#=> <form method=\"post\" action=\"/workshops/1\" class=\"button_to\">\n#=>   <input type=\"hidden\" name=\"_method\" value=\"patch\" autocomplete=\"off\" />\n#=>   <button type=\"submit\">Update</button>\n#=> </form>\nbutton_to\n(\n[\nWorkshop\n.\nfind\n(\n1\n)\n,\nSession\n.\nfind\n(\n1\n)\n]\n)\n{\n\"Update\"\n}\n#=> <form method=\"post\" action=\"/workshops/1/sessions/1\" class=\"button_to\">\n#=>   <input type=\"hidden\" name=\"_method\" value=\"patch\" autocomplete=\"off\" />\n#=>   <button type=\"submit\">Update</button>\n#=> </form>\nSean Doyle\nSupport passing a Symbol as the first argument to\nFormBuilder#button\n:\nform\n.\nbutton\n(\n:draft\n,\nvalue\n:\ntrue\n)\n# => <button name=\"post[draft]\" value=\"true\" type=\"submit\">Create post</button>\nform\n.\nbutton\n(\n:draft\n,\nvalue\n:\ntrue\n)\ndo\ncontent_tag\n(\n:strong\n,\n\"Save as draft\"\n)\nend\n# =>  <button name=\"post[draft]\" value=\"true\" type=\"submit\">\n#       <strong>Save as draft</strong>\n#     </button>\nSean Doyle\nIntroduce the\nfield_name\nview helper, along with the\nFormBuilder#field_name\ncounterpart:\nform_for\n@post\ndo\n|\nf\n|\nf\n.\nfield_tag\n:tag\n,\nname\n:\nf\n.\nfield_name\n(\n:tag\n,\nmultiple\n:\ntrue\n)\n# => <input type=\"text\" name=\"post[tag][]\">\nend\nSean Doyle\nExecute the\nActionView::Base.field_error_proc\nwithin the context of the\nActionView::Base\ninstance:\nconfig\n.\naction_view\n.\nfield_error_proc\n=\nproc\n{\n|\nhtml\n|\ncontent_tag\n(\n:div\n,\nhtml\n,\nclass\n:\n\"field_with_errors\"\n)\n}\nSean Doyle\nAdd support for\nbutton_to ..., authenticity_token: false\nbutton_to\n\"Create\"\n,\nPost\n.\nnew\n,\nauthenticity_token\n:\nfalse\n# => <form class=\"button_to\" method=\"post\" action=\"/posts\"><button type=\"submit\">Create</button></form>\nbutton_to\n\"Create\"\n,\nPost\n.\nnew\n,\nauthenticity_token\n:\ntrue\n# => <form class=\"button_to\" method=\"post\" action=\"/posts\"><button type=\"submit\">Create</button><input type=\"hidden\" name=\"form_token\" value=\"abc123...\" autocomplete=\"off\" /></form>\nbutton_to\n\"Create\"\n,\nPost\n.\nnew\n,\nauthenticity_token\n:\n\"secret\"\n# => <form class=\"button_to\" method=\"post\" action=\"/posts\"><button type=\"submit\">Create</button><input type=\"hidden\" name=\"form_token\" value=\"secret\" autocomplete=\"off\" /></form>\nSean Doyle\nSupport rendering\n<form>\nelements\nwithout\n[action]\nattributes by:\nform_with url: false\nor\nform_with ..., html: { action: false }\nform_for ..., url: false\nor\nform_for ..., html: { action: false }\nform_tag false\nor\nform_tag ..., action: false\nbutton_to \"...\", false\nor\nbutton_to(false) { ... }\nSean Doyle\nAdd\n:day_format\noption to\ndate_select\ndate_select(\"article\", \"written_on\", day_format: ->(day) { day.ordinalize })\n# generates day options like <option value=\"1\">1st</option>\\n<option value=\"2\">2nd</option>...\nShunichi Ikegami\nAllow\nlink_to\nhelper to infer link name from\nModel#to_s\nwhen it\nis used with a single argument:\nlink_to @profile\n#=> <a href=\"/profiles/1\">Eileen</a>\nThis assumes the model class implements a\nto_s\nmethod like this:\nclass Profile < ApplicationRecord\n  # ...\n  def to_s\n    name\n  end\nend\nPreviously you had to supply a second argument even if the\nProfile\nmodel implemented a\n#to_s\nmethod that called the\nname\nmethod.\nlink_to @profile, @profile.name\n#=> <a href=\"/profiles/1\">Eileen</a>\nOlivier Lacan\nSupport svg unpaired tags for\ntag\nhelper.\ntag.svg { tag.use('href' => \"#cool-icon\") }\n# => <svg><use href=\"#cool-icon\"></svg>\nOleksii Vasyliev\nImproves the performance of ActionView::Helpers::NumberHelper formatters by avoiding the use of\nexceptions as flow control.\nMike Dalessio\npreload_link_tag\nproperly inserts\nas\nattributes for files with\nimage\nMIME types, such as JPG or SVG.\nNate Berkopec\nAdd\nweekday_options_for_select\nand\nweekday_select\nhelper methods. Also adds\nweekday_select\nto\nFormBuilder\n.\nDrew Bragg\n,\nDana Kashubeck\n,\nKasper Timm Hansen\nAdd\ncaching?\nhelper that returns whether the current code path is being cached and\nuncacheable!\nto denote helper methods that can't participate in fragment caching.\nBen Toews\n,\nJohn Hawthorn\n,\nKasper Timm Hansen\n,\nJoel Hawksley\nAdd\ninclude_seconds\noption for\ntime_field\n.\n<%= form.time_field :foo, include_seconds: false %>\n# => <input value=\"16:22\" type=\"time\" />\nDefault includes seconds:\n<%= form.time_field :foo %>\n# => <input value=\"16:22:01.440\" type=\"time\" />\nThis allows you to take advantage of\ndifferent rendering options\nin some browsers.\nAlex Ghiculescu\nImprove error messages when template file does not exist at absolute filepath.\nTed Whang\nAdd\n:country_code\noption to\nsms_to\nfor consistency with\nphone_to\n.\nJonathan Hefner\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nThe\ntranslate\nhelper now passes\ndefault\nvalues that aren't\ntranslation keys through\nI18n.translate\nfor interpolation.\nJonathan Hefner\nAdds option\nextname\nto\nstylesheet_link_tag\nto skip default\n.css\nextension appended to the stylesheet path.\nBefore:\nstylesheet_link_tag\n\"style.less\"\n# <link href=\"/stylesheets/style.less.scss\" rel=\"stylesheet\">\nAfter:\nstylesheet_link_tag\n\"style.less\"\n,\nextname\n:\nfalse\n,\nskip_pipeline\n:\ntrue\n,\nrel\n:\n\"stylesheet/less\"\n# <link href=\"/stylesheets/style.less\" rel=\"stylesheet/less\">\nAbhay Nikam\nDeprecate\nrender\nlocals to be assigned to instance variables.\nPetrik de Heus\nRemove legacy default\nmedia=screen\nfrom\nstylesheet_link_tag\n.\nAndré Luis Leal Cardoso Junior\nChange\nActionView::Helpers::FormBuilder#button\nto transform\nformmethod\nattributes into\n_method=\"$VERB\"\nForm Data to enable varied same-form actions:\n<%= form_with model: post, method: :put do %>\n  <%= form.button \"Update\" %>\n  <%= form.button \"Delete\", formmethod: :delete %>\n<% end %>\n<%# => <form action=\"posts/1\">\n    =>   <input type=\"hidden\" name=\"_method\" value=\"put\">\n    =>   <button type=\"submit\">Update</button>\n    =>   <button type=\"submit\" formmethod=\"post\" name=\"_method\" value=\"delete\">Delete</button>\n    => </form>\n%>\nSean Doyle\nChange\nActionView::Helpers::UrlHelper#button_to\nto\nalways\nrender a\n<button>\nelement, regardless of whether or not the content is passed as\nthe first argument or as a block.\n<%= button_to \"Delete\", post_path(@post), method: :delete %>\n# => <form action=\"/posts/1\"><input type=\"hidden\" name=\"_method\" value=\"delete\"><button type=\"submit\">Delete</button></form>\n\n<%= button_to post_path(@post), method: :delete do %>\n  Delete\n<% end %>\n# => <form action=\"/posts/1\"><input type=\"hidden\" name=\"_method\" value=\"delete\"><button type=\"submit\">Delete</button></form>\nSean Doyle\n,\nDusan Orlovic\nAdd\nconfig.action_view.preload_links_header\nto allow disabling of\nthe\nLink\nheader being added by default when using\nstylesheet_link_tag\nand\njavascript_include_tag\n.\nAndrew White\nThe\ntranslate\nhelper now resolves\ndefault\nvalues when a\nnil\nkey is\nspecified, instead of always returning\nnil\n.\nJonathan Hefner\nAdd\nconfig.action_view.image_loading\nto configure the default value of\nthe\nimage_tag\n:loading\noption.\nBy setting\nconfig.action_view.image_loading = \"lazy\"\n, an application can opt in to\nlazy loading images sitewide, without changing view code.\nJonathan Hefner\nActionView::Helpers::FormBuilder#id\nreturns the value\nof the\n<form>\nelement's\nid\nattribute. With a\nmethod\nargument, returns\nthe\nid\nattribute for a form field with that name.\n<%= form_for @post do |f| %>\n  <%# ... %>\n\n  <% content_for :sticky_footer do %>\n    <%= form.button(form: f.id) %>\n  <% end %>\n<% end %>\nSean Doyle\nActionView::Helpers::FormBuilder#field_id\nreturns the value generated by\nthe FormBuilder for the given attribute name.\n<%= form_for @post do |f| %>\n  <%= f.label :title %>\n  <%= f.text_field :title, aria: { describedby: f.field_id(:title, :error) } %>\n  <%= tag.span(\"is blank\", id: f.field_id(:title, :error) %>\n<% end %>\nSean Doyle\nAdd\ntag.attributes\nto transform a Hash into HTML Attributes, ready to be\ninterpolated into ERB.\n<input <%= tag.attributes(type: :text, aria: { label: \"Search\" }) %> >\n# => <input type=\"text\" aria-label=\"Search\">\nSean Doyle\nActive Job\nRemove deprecated\n:return_false_on_aborted_enqueue\noption.\nRafael Mendonça França\nDeprecated\nRails.config.active_job.skip_after_callbacks_if_terminated\n.\nRafael Mendonça França\nRemoved deprecated behavior that was not halting\nafter_enqueue\n/\nafter_perform\ncallbacks when a\nprevious callback was halted with\nthrow :abort\n.\nRafael Mendonça França\nRaise an\nSerializationError\nin\nSerializer::ModuleSerializer\nif the module name is not present.\nVeerpal Brar\nAllow a job to retry indefinitely\nThe\nattempts\nparameter of the\nretry_on\nmethod now accepts the\nsymbol reference\n:unlimited\nin addition to a specific number of retry\nattempts to allow a developer to specify that a job should retry\nforever until it succeeds.\nclass MyJob < ActiveJob::Base\n  retry_on(AlwaysRetryException, attempts: :unlimited)\n\n  # the actual job code\nend\nDaniel Morton\nAdded possibility to check on\n:priority\nin test helper methods\nassert_enqueued_with\nand\nassert_performed_with\n.\nWojciech Wnętrzak\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nAdd a Serializer for the Range class.\nThis should allow things like\nMyJob.perform_later(range: 1..100)\n.\nCommunicate enqueue failures to callers of\nperform_later\n.\nperform_later\ncan now optionally take a block which will execute after\nthe adapter attempts to enqueue the job. The block will receive the job\ninstance as an argument even if the enqueue was not successful.\nAdditionally,\nActiveJob\nadapters now have the ability to raise an\nActiveJob::EnqueueError\nwhich will be caught and stored in the job\ninstance so code attempting to enqueue jobs can inspect any raised\nEnqueueError\nusing the block.\nMyJob.perform_later do |job|\n  unless job.successfully_enqueued?\n    if job.enqueue_error&.message == \"Redis was unavailable\"\n      # invoke some code that will retry the job after a delay\n    end\n  end\nend\nDaniel Morton\nDon't log rescuable exceptions defined with\nrescue_from\n.\nHu Hailin\nAllow\nrescue_from\nto rescue all exceptions.\nAdrianna Chang\n,\nÉtienne Barrié\nActive Model\nRemove support to Marshal load Rails 5.x\nActiveModel::AttributeSet\nformat.\nRafael Mendonça França\nRemove support to Marshal and YAML load Rails 5.x error format.\nRafael Mendonça França\nRemove deprecated support to use\n[]=\nin\nActiveModel::Errors#messages\n.\nRafael Mendonça França\nRemove deprecated support to\ndelete\nerrors from\nActiveModel::Errors#messages\n.\nRafael Mendonça França\nRemove deprecated support to\nclear\nerrors from\nActiveModel::Errors#messages\n.\nRafael Mendonça França\nRemove deprecated support concat errors to\nActiveModel::Errors#messages\n.\nRafael Mendonça França\nRemove deprecated\nActiveModel::Errors#to_xml\n.\nRafael Mendonça França\nRemove deprecated\nActiveModel::Errors#keys\n.\nRafael Mendonça França\nRemove deprecated\nActiveModel::Errors#values\n.\nRafael Mendonça França\nRemove deprecated\nActiveModel::Errors#slice!\n.\nRafael Mendonça França\nRemove deprecated\nActiveModel::Errors#to_h\n.\nRafael Mendonça França\nRemove deprecated enumeration of\nActiveModel::Errors\ninstances as a Hash.\nRafael Mendonça França\nClear secure password cache if password is set to\nnil\nBefore:\nuser.password = 'something'\nuser.password = nil\nuser.password # => 'something'\nNow:\nuser.password = 'something'\nuser.password = nil\nuser.password # => nil\nMarkus Doits\nIntroduce\nActiveModel::API\n.\nMake\nActiveModel::API\nthe minimum API to talk with Action Pack and Action View.\nThis will allow adding more functionality to\nActiveModel::Model\n.\nPetrik de Heus\n,\nNathaniel Watts\nFix dirty check for Float::NaN and BigDecimal::NaN.\nFloat::NaN and BigDecimal::NaN in Ruby are\nspecial values\nand can't be compared with\n==\n.\nMarcelo Lauxen\nFix\nto_json\nfor\nActiveModel::Dirty\nobject.\nExclude\nmutations_from_database\nattribute from json as it lead to recursion.\nAnil Maurya\nAdd\nActiveModel::AttributeSet#values_for_database\n.\nReturns attributes with values for assignment to the database.\nChris Salzberg\nFix delegation in ActiveModel::Type::Registry#lookup and ActiveModel::Type.lookup.\nPassing a last positional argument\n{}\nwould be incorrectly considered as keyword argument.\nBenoit Daloze\nCache and re-use generated attribute methods.\nGenerated methods with identical implementations will now share their instruction sequences\nleading to reduced memory retention, and slightly faster load time.\nJean Boussier\nAdd\nin: range\nparameter to\nnumericality\nvalidator.\nMichal Papis\nAdd\nlocale\nargument to\nActiveModel::Name#initialize\nto be used to generate the\nsingular\n,\nplural\n,\nroute_key\nand\nsingular_route_key\nvalues.\nLukas Pokorny\nMake ActiveModel::Errors#inspect slimmer for readability\nlulalala\nActive Record\nBetter handle SQL queries with invalid encoding.\nPost\n.\ncreate\n(\nname\n:\n\"broken\n\\xC8\nUTF-8\"\n)\nWould cause all adapters to fail in a non controlled way in the code\nresponsible to detect write queries.\nThe query is now properly passed to the database connection, which might or might\nnot be able to handle it, but will either succeed or failed in a more correct way.\nJean Boussier\nMove database and shard selection config options to a generator.\nRather than generating the config options in\nproduction.rb\nwhen applications are created, applications can now run a generator to create an initializer and uncomment / update options as needed. All multi-db configuration can be implemented in this initializer.\nEileen M. Uchitelle\nRemove deprecated\nActiveRecord::DatabaseConfigurations::DatabaseConfig#spec_name\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Connection#in_clause_length\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Connection#allowed_index_name_length\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base#remove_connection\n.\nRafael Mendonça França\nLoad STI Models in fixtures\nData from Fixtures now loads based on the specific class for models with\nSingle Table Inheritance. This affects enums defined in subclasses, previously\nthe value of these fields was not parsed and remained\nnil\nAndres Howard\n#authenticate\nreturns false when the password is blank instead of raising an error.\nMuhammad Muhammad Ibrahim\nFix\nActiveRecord::QueryMethods#in_order_of\nbehavior for integer enums.\nActiveRecord::QueryMethods#in_order_of\ndidn't work as expected for enums stored as integers in the database when passing an array of strings or symbols as the order argument. This unexpected behavior occurred because the string or symbol values were not casted to match the integers in the database.\nThe following example now works as expected:\nclass\nBook\n<\nApplicationRecord\nenum\nstatus\n:\n[\n:proposed\n,\n:written\n,\n:published\n]\nend\nBook\n.\nin_order_of\n(\n:status\n,\n%w[\nwritten\npublished\nproposed\n]\n)\nAlexandre Ruban\nIgnore persisted in-memory records when merging target lists.\nKevin Sjöberg\nAdd a new option\n:update_only\nto\nupsert_all\nto configure the list of columns to update in case of conflict.\nBefore, you could only customize the update SQL sentence via\n:on_duplicate\n. There is now a new option\n:update_only\nthat lets you provide a list of columns to update in case of conflict:\nCommodity\n.\nupsert_all\n(\n[\n{\nid\n:\n2\n,\nname\n:\n\"Copper\"\n,\nprice\n:\n4.84\n}\n,\n{\nid\n:\n4\n,\nname\n:\n\"Gold\"\n,\nprice\n:\n1380.87\n}\n,\n{\nid\n:\n6\n,\nname\n:\n\"Aluminium\"\n,\nprice\n:\n0.35\n}\n]\n,\nupdate_only\n:\n[\n:price\n]\n# Only prices will be updated\n)\nJorge Manrubia\nRemove deprecated\nActiveRecord::Result#map!\nand\nActiveRecord::Result#collect!\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.configurations.to_h\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.configurations.default_hash\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.arel_attribute\n.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.connection_config\n.\nRafael Mendonça França\nFilter attributes in SQL logs\nPreviously, SQL queries in logs containing\nActiveRecord::Base.filter_attributes\nwere not filtered.\nNow, the filter attributes will be masked\n[FILTERED]\nin the logs when\nprepared_statement\nis enabled.\n# Before:\n  Foo Load (0.2ms)  SELECT \"foos\".* FROM \"foos\" WHERE \"foos\".\"passw\" = ? LIMIT ?  [[\"passw\", \"hello\"], [\"LIMIT\", 1]]\n\n# After:\n  Foo Load (0.5ms)  SELECT \"foos\".* FROM \"foos\" WHERE \"foos\".\"passw\" = ? LIMIT ?  [[\"passw\", \"[FILTERED]\"], [\"LIMIT\", 1]]\nAishwarya Subramanian\nRemove deprecated\nTasks::DatabaseTasks.spec\n.\nRafael Mendonça França\nRemove deprecated\nTasks::DatabaseTasks.current_config\n.\nRafael Mendonça França\nDeprecate\nTasks::DatabaseTasks.schema_file_type\n.\nRafael Mendonça França\nRemove deprecated\nTasks::DatabaseTasks.dump_filename\n.\nRafael Mendonça França\nRemove deprecated\nTasks::DatabaseTasks.schema_file\n.\nRafael Mendonça França\nRemove deprecated\nenvironment\nand\nname\narguments from\nTasks::DatabaseTasks.schema_up_to_date?\n.\nRafael Mendonça França\nMerging conditions on the same column no longer maintain both conditions,\nand will be consistently replaced by the latter condition.\n# Rails 6.1 (IN clause is replaced by merger side equality condition)\nAuthor\n.\nwhere\n(\nid\n:\n[\ndavid\n.\nid\n,\nmary\n.\nid\n]\n)\n.\nmerge\n(\nAuthor\n.\nwhere\n(\nid\n:\nbob\n)\n)\n# => [bob]\n# Rails 6.1 (both conflict conditions exists, deprecated)\nAuthor\n.\nwhere\n(\nid\n:\ndavid\n.\nid\n..\nmary\n.\nid\n)\n.\nmerge\n(\nAuthor\n.\nwhere\n(\nid\n:\nbob\n)\n)\n# => []\n# Rails 6.1 with rewhere to migrate to Rails 7.0's behavior\nAuthor\n.\nwhere\n(\nid\n:\ndavid\n.\nid\n..\nmary\n.\nid\n)\n.\nmerge\n(\nAuthor\n.\nwhere\n(\nid\n:\nbob\n)\n,\nrewhere\n:\ntrue\n)\n# => [bob]\n# Rails 7.0 (same behavior with IN clause, mergee side condition is consistently replaced)\nAuthor\n.\nwhere\n(\nid\n:\n[\ndavid\n.\nid\n,\nmary\n.\nid\n]\n)\n.\nmerge\n(\nAuthor\n.\nwhere\n(\nid\n:\nbob\n)\n)\n# => [bob]\nAuthor\n.\nwhere\n(\nid\n:\ndavid\n.\nid\n..\nmary\n.\nid\n)\n.\nmerge\n(\nAuthor\n.\nwhere\n(\nid\n:\nbob\n)\n)\n# => [bob]\n*\nRafael\nMendonça\nFrança\n*\nRemove deprecated support to\nModel.reorder(nil).first\nto search using non-deterministic order.\nRafael Mendonça França\nRemove deprecated rake tasks:\ndb:schema:load_if_ruby\ndb:structure:dump\ndb:structure:load\ndb:structure:load_if_sql\ndb:structure:dump:#{name}\ndb:structure:load:#{name}\ndb:test:load_structure\ndb:test:load_structure:#{name}\nRafael Mendonça França\nRemove deprecated\nDatabaseConfig#config\nmethod.\nRafael Mendonça França\nRollback transactions when the block returns earlier than expected.\nBefore this change, when a transaction block returned early, the transaction would be committed.\nThe problem is that timeouts triggered inside the transaction block was also making the incomplete transaction\nto be committed, so in order to avoid this mistake, the transaction block is rolled back.\nRafael Mendonça França\nAdd middleware for automatic shard swapping.\nProvides a basic middleware to perform automatic shard swapping. Applications will provide a resolver which will determine for an individual request which shard should be used. Example:\nconfig\n.\nactive_record\n.\nshard_resolver\n=\n->\n(\nrequest\n)\n{\nsubdomain\n=\nrequest\n.\nsubdomain\ntenant\n=\nTenant\n.\nfind_by_subdomain!\n(\nsubdomain\n)\ntenant\n.\nshard\n}\nSee guides for more details.\nEileen M. Uchitelle\n,\nJohn Crepezzi\nRemove deprecated support to pass a column to\ntype_cast\n.\nRafael Mendonça França\nRemove deprecated support to type cast to database values\nActiveRecord::Base\nobjects.\nRafael Mendonça França\nRemove deprecated support to quote\nActiveRecord::Base\nobjects.\nRafael Mendonça França\nRemove deprecacated support to resolve connection using\n\"primary\"\nas connection specification name.\nRafael Mendonça França\nRemove deprecation warning when using\n:interval\ncolumn is used in PostgreSQL database.\nNow, interval columns will return\nActiveSupport::Duration\nobjects instead of strings.\nTo keep the old behavior, you can add this line to your model:\nattribute\n:column\n,\n:string\nRafael Mendonça França\nRemove deprecated support to YAML load\nActiveRecord::Base\ninstance in the Rails 4.2 and 4.1 formats.\nRafael Mendonça França\nRemove deprecated option\n:spec_name\nin the\nconfigs_for\nmethod.\nRafael Mendonça França\nRemove deprecated\nActiveRecord::Base.allow_unsafe_raw_sql\n.\nRafael Mendonça França\nFix regression bug that caused ignoring additional conditions for preloading has_many-through relations.\nFixes\n#43132\nAlexander Pauly\nFix\nhas_many\ninversing recursion on models with recursive associations.\nGannon McGibbon\nAdd\naccepts_nested_attributes_for\nsupport for\ndelegated_type\nclass\nEntry\n<\nApplicationRecord\ndelegated_type\n:entryable\n,\ntypes\n:\n%w[\nMessage\nComment\n]\naccepts_nested_attributes_for\n:entryable\nend\nentry\n=\nEntry\n.\ncreate\n(\nentryable_type\n:\n'Message'\n,\nentryable_attributes\n:\n{\ncontent\n:\n'Hello world'\n}\n)\n# => #<Entry:0x00>\n# id: 1\n# entryable_id: 1,\n# entryable_type: 'Message'\n# ...>\nentry\n.\nentryable\n# => #<Message:0x01>\n# id: 1\n# content: 'Hello world'\n# ...>\nPreviously it would raise an error:\nEntry\n.\ncreate\n(\nentryable_type\n:\n'Message'\n,\nentryable_attributes\n:\n{\ncontent\n:\n'Hello world'\n}\n)\n# ArgumentError: Cannot build association `entryable'. Are you trying to build a polymorphic one-to-one association?\nSjors Baltus\nUse subquery for DELETE with GROUP_BY and HAVING clauses.\nPrior to this change, deletes with GROUP_BY and HAVING were returning an error.\nAfter this change, GROUP_BY and HAVING are valid clauses in DELETE queries, generating the following query:\nDELETE\nFROM\n\"\nposts\n\"\nWHERE\n\"\nposts\n\"\n.\n\"\nid\n\"\nIN\n(\nSELECT\n\"\nposts\n\"\n.\n\"\nid\n\"\nFROM\n\"\nposts\n\"\nINNER JOIN\n\"\ncomments\n\"\nON\n\"\ncomments\n\"\n.\n\"\npost_id\n\"\n=\n\"\nposts\n\"\n.\n\"\nid\n\"\nGROUP BY\n\"\nposts\n\"\n.\n\"\nid\n\"\nHAVING\n(\ncount\n(\ncomments\n.\nid\n)\n>=\n2\n))\n)  [[\n\"\nflagged\n\"\n,\n\"\nt\n\"\n]]\nIgnacio Chiazzo Cardarello\nUse subquery for UPDATE with GROUP_BY and HAVING clauses.\nPrior to this change, updates with GROUP_BY and HAVING were being ignored, generating a SQL like this:\nUPDATE\n\"\nposts\n\"\nSET\n\"\nflagged\n\"\n=\n?\nWHERE\n\"\nposts\n\"\n.\n\"\nid\n\"\nIN\n(\nSELECT\n\"\nposts\n\"\n.\n\"\nid\n\"\nFROM\n\"\nposts\n\"\nINNER JOIN\n\"\ncomments\n\"\nON\n\"\ncomments\n\"\n.\n\"\npost_id\n\"\n=\n\"\nposts\n\"\n.\n\"\nid\n\"\n)  [[\n\"\nflagged\n\"\n,\n\"\nt\n\"\n]]\nAfter this change, GROUP_BY and HAVING clauses are used as a subquery in updates, like this:\nUPDATE\n\"\nposts\n\"\nSET\n\"\nflagged\n\"\n=\n?\nWHERE\n\"\nposts\n\"\n.\n\"\nid\n\"\nIN\n(\nSELECT\n\"\nposts\n\"\n.\n\"\nid\n\"\nFROM\n\"\nposts\n\"\nINNER JOIN\n\"\ncomments\n\"\nON\n\"\ncomments\n\"\n.\n\"\npost_id\n\"\n=\n\"\nposts\n\"\n.\n\"\nid\n\"\nGROUP BY\nposts\n.\nid\nHAVING\n(\ncount\n(\ncomments\n.\nid\n)\n>=\n2\n)\n)  [[\n\"\nflagged\n\"\n,\n\"\nt\n\"\n]]\nIgnacio Chiazzo Cardarello\nAdd support for setting the filename of the schema or structure dump in the database config.\nApplications may now set their the filename or path of the schema / structure dump file in their database configuration.\nproduction\n:\nprimary\n:\ndatabase\n:\nmy_db\nschema_dump\n:\nmy_schema_dump_filename.rb\nanimals\n:\ndatabase\n:\nanimals_db\nschema_dump\n:\nfalse\nThe filename set in\nschema_dump\nwill be used by the application. If set to\nfalse\nthe schema will not be dumped. The database tasks are responsible for adding the database directory to the filename. If a full path is provided, the Rails tasks will use that instead of\nActiveRecord::DatabaseTasks.db_dir\n.\nEileen M. Uchitelle\n,\nRyan Kerr\nAdd\nActiveRecord::Base.prohibit_shard_swapping\nto prevent attempts to change the shard within a block.\nJohn Crepezzi\n,\nEileen M. Uchitelle\nFilter unchanged attributes with default function from insert query when\npartial_inserts\nis disabled.\nAkshay Birajdar\n,\nJacopo Beschi\nAdd support for FILTER clause (SQL:2003) to Arel.\nCurrently supported by PostgreSQL 9.4+ and SQLite 3.30+.\nAndrey Novikov\nAutomatically set timestamps on record creation during bulk insert/upsert\nPrior to this change, only updates during an upsert operation (e.g.\nupsert_all\n) would touch timestamps (\nupdated_{at,on}\n). Now, record creations also touch timestamp columns (\n{created,updated}_{at,on}\n).\nThis behaviour is controlled by the\n<model>.record_timestamps\nconfig, matching the behaviour of\ncreate\n,\nupdate\n, etc. It can also be overridden by using the\nrecord_timestamps:\nkeyword argument.\nNote that this means\nupsert_all\non models with\nrecord_timestamps = false\nwill no longer touch\nupdated_{at,on}\nautomatically.\nSam Bostock\nDon't require\nrole\nwhen passing\nshard\nto\nconnected_to\n.\nconnected_to\ncan now be called with a\nshard\nonly. Note that\nrole\nis still inherited if\nconnected_to\ncalls are nested.\nEileen M. Uchitelle\nAdd option to lazily load the schema cache on the connection.\nPreviously, the only way to load the schema cache in Active Record was through the Railtie on boot. This option provides the ability to load the schema cache on the connection after it's been established. Loading the cache lazily on the connection can be beneficial for Rails applications that use multiple databases because it will load the cache at the time the connection is established. Currently Railties doesn't have access to the connections before boot.\nTo use the cache, set\nconfig.active_record.lazily_load_schema_cache = true\nin your application configuration. In addition a\nschema_cache_path\nshould be set in your database configuration if you don't want to use the default \"db/schema_cache.yml\" path.\nEileen M. Uchitelle\nAllow automatic\ninverse_of\ndetection for associations with scopes.\nAutomatic\ninverse_of\ndetection now works for associations with scopes. For\nexample, the\ncomments\nassociation here now automatically detects\ninverse_of: :post\n, so we don't need to pass that option:\nclass\nPost\n<\nActiveRecord\n::\nBase\nhas_many\n:comments\n,\n->\n{\nvisible\n}\nend\nclass\nComment\n<\nActiveRecord\n::\nBase\nbelongs_to\n:post\nend\nNote that the automatic detection still won't work if the inverse\nassociation has a scope. In this example a scope on the\npost\nassociation\nwould still prevent Rails from finding the inverse for the\ncomments\nassociation.\nThis will be the default for new apps in Rails 7. To opt in:\nconfig\n.\nactive_record\n.\nautomatic_scope_inversing\n=\ntrue\nDaniel Colson\n,\nChris Bloom\nAccept optional transaction args to\nActiveRecord::Locking::Pessimistic#with_lock\n#with_lock\nnow accepts transaction options like\nrequires_new:\n,\nisolation:\n, and\njoinable:\nJohn Mileham\nAdds support for deferrable foreign key constraints in PostgreSQL.\nBy default, foreign key constraints in PostgreSQL are checked after each statement. This works for most use cases,\nbut becomes a major limitation when creating related records before the parent record is inserted into the database.\nOne example of this is looking up / creating a person via one or more unique alias.\nPerson\n.\ntransaction\ndo\nalias\n=\nAlias\n.\ncreate_with\n(\nuser_id\n:\nSecureRandom\n.\nuuid\n)\n.\ncreate_or_find_by\n(\nname\n:\n\"DHH\"\n)\nperson\n=\nPerson\n.\ncreate_with\n(\nname\n:\n\"David Heinemeier Hansson\"\n)\n.\ncreate_or_find_by\n(\nid\n:\nalias\n.\nuser_id\n)\nend\nUsing the default behavior, the transaction would fail when executing the first\nINSERT\nstatement.\nBy passing the\n:deferrable\noption to the\nadd_foreign_key\nstatement in migrations, it's possible to defer this\ncheck.\nadd_foreign_key\n:aliases\n,\n:person\n,\ndeferrable\n:\ntrue\nPassing\ndeferrable: true\ndoesn't change the default behavior, but allows manually deferring the check using\nSET CONSTRAINTS ALL DEFERRED\nwithin a transaction. This will cause the foreign keys to be checked after the\ntransaction.\nIt's also possible to adjust the default behavior from an immediate check (after the statement), to a deferred check\n(after the transaction):\nadd_foreign_key\n:aliases\n,\n:person\n,\ndeferrable\n:\n:deferred\nBenedikt Deicke\nAllow configuring Postgres password through the socket URL.\nFor example:\nActiveRecord\n::\nDatabaseConfigurations\n::\nUrlConfig\n.\nnew\n(\n:production\n,\n:production\n,\n'postgres:///?user=user&password=secret&dbname=app'\n,\n{\n}\n)\n.\nconfiguration_hash\nwill now return,\n{\n:user\n=>\n\"user\"\n,\n:password\n=>\n\"secret\"\n,\n:dbname\n=>\n\"app\"\n,\n:adapter\n=>\n\"postgresql\"\n}\nAbeid Ahmed\nPostgreSQL: support custom enum types\nIn migrations, use\ncreate_enum\nto add a new enum type, and\nt.enum\nto add a column.\ndef\nup\ncreate_enum\n:mood\n,\n[\n\"happy\"\n,\n\"sad\"\n]\nchange_table\n:cats\ndo\n|\nt\n|\nt\n.\nenum\n:current_mood\n,\nenum_type\n:\n\"mood\"\n,\ndefault\n:\n\"happy\"\n,\nnull\n:\nfalse\nend\nend\nEnums will be presented correctly in\nschema.rb\n. Note that this is only supported by\nthe PostgreSQL adapter.\nAlex Ghiculescu\nAvoid COMMENT statements in PostgreSQL structure dumps\nCOMMENT statements are now omitted from the output of\ndb:structure:dump\nwhen using PostgreSQL >= 11.\nThis allows loading the dump without a pgsql superuser account.\nFixes\n#36816\n,\n#43107\n.\nJanosch Müller\nAdd support for generated columns in PostgreSQL adapter\nGenerated columns are supported since version 12.0 of PostgreSQL. This adds\nsupport of those to the PostgreSQL adapter.\ncreate_table\n:users\ndo\n|\nt\n|\nt\n.\nstring\n:name\nt\n.\nvirtual\n:name_upcased\n,\ntype\n:\n:string\n,\nas\n:\n'upper(name)'\n,\nstored\n:\ntrue\nend\nMichał Begejowicz\nRemove warning when overwriting existing scopes\nRemoves the following unnecessary warning message that appeared when overwriting existing scopes\nCreating scope :my_scope_name. Overwriting existing method \"MyClass.my_scope_name\" when overwriting existing scopes\nWeston Ganger\nUse full precision for\nupdated_at\nin\ninsert_all\n/\nupsert_all\nCURRENT_TIMESTAMP\nprovides differing precision depending on the database,\nand not all databases support explicitly specifying additional precision.\nInstead, we delegate to the new\nconnection.high_precision_current_timestamp\nfor the SQL to produce a high precision timestamp on the current database.\nFixes\n#42992\nSam Bostock\nAdd ssl support for postgresql database tasks\nAdd\nPGSSLMODE\n,\nPGSSLCERT\n,\nPGSSLKEY\nand\nPGSSLROOTCERT\nto pg_env from database config\nwhen running postgresql database tasks.\n#\nconfig/database.yml\nproduction\n:\nsslmode\n:\nverify-full\nsslcert\n:\nclient.crt\nsslkey\n:\nclient.key\nsslrootcert\n:\nca.crt\nEnvironment variables\nPGSSLMODE=verify-full\nPGSSLCERT=client.crt\nPGSSLKEY=client.key\nPGSSLROOTCERT=ca.crt\nFixes\n#42994\nMichael Bayucot\nAvoid scoping update callbacks in\nActiveRecord::Relation#update!\n.\nMaking it consistent with how scoping is applied only to the query in\nActiveRecord::Relation#update\nand not also to the callbacks from the update itself.\nDylan Thacker-Smith\nFix 2 cases that inferred polymorphic class from the association's\nforeign_type\nusing\nString#constantize\ninstead of the model's\npolymorphic_class_for\n.\nWhen updating a polymorphic association, the old\nforeign_type\nwas not inferred correctly when:\ntouch\ning the previously associated record\nupdating the previously associated record's\ncounter_cache\nJimmy Bourassa\nAdd config option for ignoring tables when dumping the schema cache.\nApplications can now be configured to ignore certain tables when dumping the schema cache.\nThe configuration option can table an array of tables:\nconfig\n.\nactive_record\n.\nschema_cache_ignored_tables\n=\n[\n\"ignored_table\"\n,\n\"another_ignored_table\"\n]\nOr a regex:\nconfig\n.\nactive_record\n.\nschema_cache_ignored_tables\n=\n[\n/^_/\n]\nEileen M. Uchitelle\nMake schema cache methods return consistent results.\nPreviously the schema cache methods\nprimary_keys\n,\ncolumns\n,\ncolumns_hash\n, and\nindexes\nwould behave differently than one another when a table didn't exist and differently across\ndatabase adapters. This change unifies the behavior so each method behaves the same regardless\nof adapter.\nThe behavior now is:\ncolumns\n: (unchanged) raises a db error if the table does not exist.\ncolumns_hash\n: (unchanged) raises a db error if the table does not exist.\nprimary_keys\n: (unchanged) returns\nnil\nif the table does not exist.\nindexes\n: (changed for mysql2) returns\n[]\nif the table does not exist.\nEileen M. Uchitelle\nReestablish connection to previous database after after running\ndb:schema:load:name\nAfter running\ndb:schema:load:name\nthe previous connection is restored.\nJacopo Beschi\nAdd database config option\ndatabase_tasks\nIf you would like to connect to an external database without any database\nmanagement tasks such as schema management, migrations, seeds, etc. you can set\nthe per database config option\ndatabase_tasks: false\n#\nconfig/database.yml\nproduction\n:\nprimary\n:\ndatabase\n:\nmy_database\nadapter\n:\nmysql2\nanimals\n:\ndatabase\n:\nmy_animals_database\nadapter\n:\nmysql2\ndatabase_tasks\n:\nfalse\nWeston Ganger\nFix\nActiveRecord::InternalMetadata\nto not be broken by\nconfig.active_record.record_timestamps = false\nSince the model always create the timestamp columns, it has to set them, otherwise it breaks\nvarious DB management tasks.\nFixes\n#42983\nAdd\nActiveRecord::QueryLogs\n.\nConfigurable tags can be automatically added to all SQL queries generated by Active Record.\n# config/application.rb\nmodule\nMyApp\nclass\nApplication\n<\nRails\n::\nApplication\nconfig\n.\nactive_record\n.\nquery_log_tags_enabled\n=\ntrue\nend\nend\nBy default the application, controller and action details are added to the query tags:\nclass\nBooksController\n<\nApplicationController\ndef\nindex\n@books\n=\nBook\n.\nall\nend\nend\nGET\n/books\n# SELECT * FROM books /\n*\napplication\n:\nMyApp\n;\ncontroller\n:books\n;\naction\n:index\n*\n/\nCustom tags containing static values and Procs can be defined in the application configuration:\nconfig\n.\nactive_record\n.\nquery_log_tags\n=\n[\n:application\n,\n:controller\n,\n:action\n,\n{\ncustom_static\n:\n\"foo\"\n,\ncustom_dynamic\n:\n->\n{\nTime\n.\nnow\n}\n}\n]\nKeeran Raj Hawoldar\n,\nEileen M. Uchitelle\n,\nKasper Timm Hansen\nAdded support for multiple databases to\nrails db:setup\nand\nrails db:reset\n.\nRyan Hall\nAdd\nActiveRecord::Relation#structurally_compatible?\n.\nAdds a query method by which a user can tell if the relation that they're\nabout to use for\n#or\nor\n#and\nis structurally compatible with the\nreceiver.\nKevin Newton\nAdd\nActiveRecord::QueryMethods#in_order_of\n.\nThis allows you to specify an explicit order that you'd like records\nreturned in based on a SQL expression. By default, this will be accomplished\nusing a case statement, as in:\nPost\n.\nin_order_of\n(\n:id\n,\n[\n3\n,\n5\n,\n1\n]\n)\nwill generate the SQL:\nSELECT\n\"\nposts\n\"\n.\n*\nFROM\n\"\nposts\n\"\nORDER BY\nCASE\n\"\nposts\n\"\n.\n\"\nid\n\"\nWHEN\n3\nTHEN\n1\nWHEN\n5\nTHEN\n2\nWHEN\n1\nTHEN\n3\nELSE\n4\nEND\nASC\nHowever, because this functionality is built into MySQL in the form of the\nFIELD\nfunction, that connection adapter will generate the following SQL\ninstead:\nSELECT\n\"\nposts\n\"\n.\n*\nFROM\n\"\nposts\n\"\nORDER BY\nFIELD(\n\"\nposts\n\"\n.\n\"\nid\n\"\n,\n1\n,\n5\n,\n3\n)\nDESC\nKevin Newton\nFix\neager_loading?\nwhen ordering with\nSymbol\n.\neager_loading?\nis triggered correctly when using\norder\nwith symbols.\nscope\n=\nPost\n.\nincludes\n(\n:comments\n)\n.\norder\n(\n:\"comments.label\"\n)\n=>\ntrue\nJacopo Beschi\nTwo change tracking methods are added for\nbelongs_to\nassociations.\nThe\nassociation_changed?\nmethod (assuming an association named\n:association\n) returns true\nif a different associated object has been assigned and the foreign key will be updated in the\nnext save.\nThe\nassociation_previously_changed?\nmethod returns true if the previous save updated the\nassociation to reference a different associated object.\nGeorge Claghorn\nAdd option to disable schema dump per-database.\nDumping the schema is on by default for all databases in an application. To turn it off for a\nspecific database, use the\nschema_dump\noption:\n#\nconfig/database.yml\nproduction\n:\nschema_dump\n:\nfalse\nLuis Vasconcellos\n,\nEileen M. Uchitelle\nFix\neager_loading?\nwhen ordering with\nHash\nsyntax.\neager_loading?\nis triggered correctly when using\norder\nwith hash syntax\non an outer table.\nPost\n.\nincludes\n(\n:comments\n)\n.\norder\n(\n{\n\"comments.label\"\n:\n:ASC\n}\n)\n.\neager_loading?\n# => true\nJacopo Beschi\nMove the forcing of clear text encoding to the\nActiveRecord::Encryption::Encryptor\n.\nFixes\n#42699\n.\nJ Smith\npartial_inserts\nis now disabled by default in new apps.\nThis will be the default for new apps in Rails 7. To opt in:\nconfig\n.\nactive_record\n.\npartial_inserts\n=\ntrue\nIf a migration removes the default value of a column, this option\nwould cause old processes to no longer be able to create new records.\nIf you need to remove a column, you should first use\nignored_columns\nto stop using it.\nJean Boussier\nRails can now verify foreign keys after loading fixtures in tests.\nThis will be the default for new apps in Rails 7. To opt in:\nconfig\n.\nactive_record\n.\nverify_foreign_keys_for_fixtures\n=\ntrue\nTests will not run if there is a foreign key constraint violation in your fixture data.\nThe feature is supported by SQLite and PostgreSQL, other adapters can also add support for it.\nAlex Ghiculescu\nClear cached\nhas_one\nassociation after setting\nbelongs_to\nassociation to\nnil\n.\nAfter setting a\nbelongs_to\nrelation to\nnil\nand updating an unrelated attribute on the owner,\nthe owner should still return\nnil\non the\nhas_one\nrelation.\nFixes\n#42597\n.\nMichiel de Mare\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nAdds support for\nif_not_exists\nto\nadd_foreign_key\nand\nif_exists\nto\nremove_foreign_key\n.\nApplications can set their migrations to ignore exceptions raised when adding a foreign key\nthat already exists or when removing a foreign key that does not exist.\nExample Usage:\nclass\nAddAuthorsForeignKeyToArticles\n<\nActiveRecord\n::\nMigration\n[\n7.0\n]\ndef\nchange\nadd_foreign_key\n:articles\n,\n:authors\n,\nif_not_exists\n:\ntrue\nend\nend\nclass\nRemoveAuthorsForeignKeyFromArticles\n<\nActiveRecord\n::\nMigration\n[\n7.0\n]\ndef\nchange\nremove_foreign_key\n:articles\n,\n:authors\n,\nif_exists\n:\ntrue\nend\nend\nRoberto Miranda\nPrevent polluting ENV during postgresql structure dump/load.\nSome configuration parameters were provided to pg_dump / psql via\nenvironment variables which persisted beyond the command being run, and may\nhave caused subsequent commands and connections to fail. Tasks running\nacross multiple postgresql databases like\nrails db:test:prepare\nmay have\nbeen affected.\nSamuel Cochran\nSet precision 6 by default for\ndatetime\ncolumns.\nBy default, datetime columns will have microseconds precision instead of seconds precision.\nRoberto Miranda\nAllow preloading of associations with instance dependent scopes.\nJohn Hawthorn\n,\nJohn Crepezzi\n,\nAdam Hess\n,\nEileen M. Uchitelle\n,\nDinah Shi\nDo not try to rollback transactions that failed due to a\nActiveRecord::TransactionRollbackError\n.\nJamie McCarthy\nActive Record Encryption will now encode values as UTF-8 when using deterministic\nencryption. The encoding is part of the encrypted payload, so different encodings for\ndifferent values result in different ciphertexts. This can break unique constraints and\nqueries.\nThe new behavior is configurable via\nactive_record.encryption.forced_encoding_for_deterministic_encryption\nthat is\nEncoding::UTF_8\nby default. It can be disabled by setting it to\nnil\n.\nJorge Manrubia\nThe MySQL adapter now cast numbers and booleans bind parameters to string for safety reasons.\nWhen comparing a string and a number in a query, MySQL converts the string to a number. So for\ninstance\n\"foo\" = 0\n, will implicitly cast\n\"foo\"\nto\n0\nand will evaluate to\nTRUE\nwhich can\nlead to security vulnerabilities.\nActive Record already protect against that vulnerability when it knows the type of the column\nbeing compared, however until now it was still vulnerable when using bind parameters:\nUser\n.\nwhere\n(\n\"login_token = ?\"\n,\n0\n)\n.\nfirst\nWould perform:\nSELECT\n*\nFROM\n`\nusers\n`\nWHERE\n`\nlogin_token\n`\n=\n0\nLIMIT\n1\n;\nNow it will perform:\nSELECT\n*\nFROM\n`\nusers\n`\nWHERE\n`\nlogin_token\n`\n=\n'\n0\n'\nLIMIT\n1\n;\nJean Boussier\nFixture configurations (\n_fixture\n) are now strictly validated.\nIf an error will be raised if that entry contains unknown keys while previously it\nwould silently have no effects.\nJean Boussier\nAdd\nActiveRecord::Base.update!\nthat works like\nActiveRecord::Base.update\nbut raises exceptions.\nThis allows for the same behavior as the instance method\n#update!\nat a class level.\nPerson\n.\nupdate!\n(\n:all\n,\nstate\n:\n\"confirmed\"\n)\nDorian Marié\nAdd\nActiveRecord::Base#attributes_for_database\n.\nReturns attributes with values for assignment to the database.\nChris Salzberg\nUse an empty query to check if the PostgreSQL connection is still active.\nAn empty query is faster than\nSELECT 1\n.\nHeinrich Lee Yu\nAdd\nActiveRecord::Base#previously_persisted?\n.\nReturns\ntrue\nif the object has been previously persisted but now it has been deleted.\nDeprecate\npartial_writes\nin favor of\npartial_inserts\nand\npartial_updates\n.\nThis allows to have a different behavior on update and create.\nJean Boussier\nFix compatibility with\npsych >= 4\n.\nStarting in Psych 4.0.0\nYAML.load\nbehaves like\nYAML.safe_load\n. To preserve compatibility,\nActive Record's schema cache loader and\nYAMLColumn\nnow uses\nYAML.unsafe_load\nif available.\nJean Boussier\nActiveRecord::Base.logger\nis now a\nclass_attribute\n.\nThis means it can no longer be accessed directly through\n@@logger\n, and that setting\nlogger =\non a subclass won't change the parent's logger.\nJean Boussier\nAdd\n.asc.nulls_first\nfor all databases. Unfortunately MySQL still doesn't like\nnulls_last\n.\nKeenan Brock\nImprove performance of\none?\nand\nmany?\nby limiting the generated count query to 2 results.\nGonzalo Riestra\nDon't check type when using\nif_not_exists\non\nadd_column\n.\nPreviously, if a migration called\nadd_column\nwith the\nif_not_exists\noption set to true\nthe\ncolumn_exists?\ncheck would look for a column with the same name and type as the migration.\nRecently it was discovered that the type passed to the migration is not always the same type\nas the column after migration. For example a column set to\n:mediumblob\nin the migration will\nbe casted to\nbinary\nwhen calling\ncolumn.type\n. Since there is no straightforward way to cast\nthe type to the database type without running the migration, we opted to drop the type check from\nadd_column\n. This means that migrations adding a duplicate column with a different type will no\nlonger raise an error.\nEileen M. Uchitelle\nLog a warning message when running SQLite in production.\nUsing SQLite in production ENV is generally discouraged. SQLite is also the default adapter\nin a new Rails application.\nFor the above reasons log a warning message when running SQLite in production.\nThe warning can be disabled by setting\nconfig.active_record.sqlite3_production_warning=false\n.\nJacopo Beschi\nAdd option to disable joins for\nhas_one\nassociations.\nIn a multiple database application, associations can't join across\ndatabases. When set, this option instructs Rails to generate 2 or\nmore queries rather than generating joins for\nhas_one\nassociations.\nSet the option on a has one through association:\nclass\nPerson\nhas_one\n:dog\nhas_one\n:veterinarian\n,\nthrough\n:\n:dog\n,\ndisable_joins\n:\ntrue\nend\nThen instead of generating join SQL, two queries are used for\n@person.veterinarian\n:\nSELECT \"dogs\".\"id\" FROM \"dogs\" WHERE \"dogs\".\"person_id\" = ?  [[\"person_id\", 1]]\nSELECT \"veterinarians\".* FROM \"veterinarians\" WHERE \"veterinarians\".\"dog_id\" = ?  [[\"dog_id\", 1]]\nSarah Vessels\n,\nEileen M. Uchitelle\nArel::Visitors::Dot\nnow renders a complete set of properties when visiting\nArel::Nodes::SelectCore\n,\nSelectStatement\n,\nInsertStatement\n,\nUpdateStatement\n, and\nDeleteStatement\n, which fixes\n#42026\n. Previously, some properties were omitted.\nMike Dalessio\nArel::Visitors::Dot\nnow supports\nArel::Nodes::Bin\n,\nCase\n,\nCurrentRow\n,\nDistinct\n,\nDistinctOn\n,\nElse\n,\nExcept\n,\nInfixOperation\n,\nIntersect\n,\nLock\n,\nNotRegexp\n,\nQuoted\n,\nRegexp\n,\nUnaryOperation\n,\nUnion\n,\nUnionAll\n,\nWhen\n, and\nWith\n. Previously, these node\ntypes caused an exception to be raised by\nArel::Visitors::Dot#accept\n.\nMike Dalessio\nOptimize\nremove_columns\nto use a single SQL statement.\nremove_columns\n:my_table\n,\n:col_one\n,\n:col_two\nNow results in the following SQL:\nALTER\nTABLE\n\"\nmy_table\n\"\nDROP COLUMN\n\"\ncol_one\n\"\n, DROP COLUMN\n\"\ncol_two\n\"\nJon Dufresne\nEnsure\nhas_one\nautosave association callbacks get called once.\nChange the\nhas_one\nautosave callback to be non cyclic as well.\nBy doing this the autosave callback are made more consistent for\nall 3 cases:\nhas_many\n,\nhas_one\n, and\nbelongs_to\n.\nPetrik de Heus\nAdd option to disable joins for associations.\nIn a multiple database application, associations can't join across\ndatabases. When set, this option instructs Rails to generate 2 or\nmore queries rather than generating joins for associations.\nSet the option on a has many through association:\nclass\nDog\nhas_many\n:treats\n,\nthrough\n:\n:humans\n,\ndisable_joins\n:\ntrue\nhas_many\n:humans\nend\nThen instead of generating join SQL, two queries are used for\n@dog.treats\n:\nSELECT \"humans\".\"id\" FROM \"humans\" WHERE \"humans\".\"dog_id\" = ?  [[\"dog_id\", 1]]\nSELECT \"treats\".* FROM \"treats\" WHERE \"treats\".\"human_id\" IN (?, ?, ?)  [[\"human_id\", 1], [\"human_id\", 2], [\"human_id\", 3]]\nEileen M. Uchitelle\n,\nAaron Patterson\n,\nLee Quarella\nAdd setting for enumerating column names in SELECT statements.\nAdding a column to a PostgreSQL database, for example, while the application is running can\nchange the result of wildcard\nSELECT *\nqueries, which invalidates the result\nof cached prepared statements and raises a\nPreparedStatementCacheExpired\nerror.\nWhen enabled, Active Record will avoid wildcards and always include column names\nin\nSELECT\nqueries, which will return consistent results and avoid prepared\nstatement errors.\nBefore:\nBook\n.\nlimit\n(\n5\n)\n# SELECT * FROM books LIMIT 5\nAfter:\n# config/application.rb\nmodule\nMyApp\nclass\nApplication\n<\nRails\n::\nApplication\nconfig\n.\nactive_record\n.\nenumerate_columns_in_select_statements\n=\ntrue\nend\nend\n# or, configure per-model\nclass\nBook\n<\nApplicationRecord\nself\n.\nenumerate_columns_in_select_statements\n=\ntrue\nend\nBook\n.\nlimit\n(\n5\n)\n# SELECT id, author_id, name, format, status, language, etc FROM books LIMIT 5\nMatt Duszynski\nAllow passing SQL as\non_duplicate\nvalue to\n#upsert_all\nto make it possible to use raw SQL to update columns on conflict:\nBook\n.\nupsert_all\n(\n[\n{\nid\n:\n1\n,\nstatus\n:\n1\n}\n,\n{\nid\n:\n2\n,\nstatus\n:\n1\n}\n]\n,\non_duplicate\n:\nArel\n.\nsql\n(\n\"status = GREATEST(books.status, EXCLUDED.status)\"\n)\n)\nVladimir Dementyev\nAllow passing SQL as\nreturning\nstatement to\n#upsert_all\n:\nArticle\n.\ninsert_all\n(\n[\n{\ntitle\n:\n\"Article 1\"\n,\nslug\n:\n\"article-1\"\n,\npublished\n:\nfalse\n}\n,\n{\ntitle\n:\n\"Article 2\"\n,\nslug\n:\n\"article-2\"\n,\npublished\n:\nfalse\n}\n]\n,\nreturning\n:\nArel\n.\nsql\n(\n\"id, (xmax = '0') as inserted, name as new_name\"\n)\n)\nVladimir Dementyev\nDeprecate\nlegacy_connection_handling\n.\nEileen M. Uchitelle\nAdd attribute encryption support.\nEncrypted attributes are declared at the model level. These\nare regular Active Record attributes backed by a column with\nthe same name. The system will transparently encrypt these\nattributes before saving them into the database and will\ndecrypt them when retrieving their values.\nclass\nPerson\n<\nApplicationRecord\nencrypts\n:name\nencrypts\n:email_address\n,\ndeterministic\n:\ntrue\nend\nYou can learn more in the\nActive Record Encryption\nguide\n.\nJorge Manrubia\nChanged Arel predications\ncontains\nand\noverlaps\nto use\nquoted_node\nso that PostgreSQL arrays are quoted properly.\nBradley Priest\nAdd mode argument to record level\nstrict_loading!\n.\nThis argument can be used when enabling strict loading for a single record\nto specify that we only want to raise on n plus one queries.\ndeveloper\n.\nstrict_loading!\n(\nmode\n:\n:n_plus_one_only\n)\ndeveloper\n.\nprojects\n.\nto_a\n# Does not raise\ndeveloper\n.\nprojects\n.\nfirst\n.\nclient\n# Raises StrictLoadingViolationError\nPreviously, enabling strict loading would cause any lazily loaded\nassociation to raise an error. Using\nn_plus_one_only\nmode allows us to\nlazily load belongs_to, has_many, and other associations that are fetched\nthrough a single query.\nDinah Shi\nFix Float::INFINITY assignment to datetime column with postgresql adapter.\nBefore:\n# With this config\nActiveRecord\n::\nBase\n.\ntime_zone_aware_attributes\n=\ntrue\n# and the following schema:\ncreate_table\n\"postgresql_infinities\"\ndo\n|\nt\n|\nt\n.\ndatetime\n\"datetime\"\nend\n# This test fails\nrecord\n=\nPostgresqlInfinity\n.\ncreate!\n(\ndatetime\n:\nFloat\n::\nINFINITY\n)\nassert_equal\nFloat\n::\nINFINITY\n,\nrecord\n.\ndatetime\n# record.datetime gets nil\nAfter this commit,\nrecord.datetime\ngets\nFloat::INFINITY\nas expected.\nShunichi Ikegami\nType cast enum values by the original attribute type.\nThe notable thing about this change is that unknown labels will no longer match 0 on MySQL.\nclass\nBook\n<\nActiveRecord\n::\nBase\nenum\n:status\n,\n{\nproposed\n:\n0\n,\nwritten\n:\n1\n,\npublished\n:\n2\n}\nend\nBefore:\n# SELECT `books`.* FROM `books` WHERE `books`.`status` = 'prohibited' LIMIT 1\nBook\n.\nfind_by\n(\nstatus\n:\n:prohibited\n)\n# => #<Book id: 1, status: \"proposed\", ...> (for mysql2 adapter)\n# => ActiveRecord::StatementInvalid: PG::InvalidTextRepresentation: ERROR:  invalid input syntax for type integer: \"prohibited\" (for postgresql adapter)\n# => nil (for sqlite3 adapter)\nAfter:\n# SELECT `books`.* FROM `books` WHERE `books`.`status` IS NULL LIMIT 1\nBook\n.\nfind_by\n(\nstatus\n:\n:prohibited\n)\n# => nil (for all adapters)\nRyuta Kamizono\nFixtures for\nhas_many :through\nassociations now load timestamps on join tables.\nGiven this fixture:\n#\n## monkeys.yml\ngeorge\n:\nname\n:\nGeorge the Monkey\nfruits\n:\napple\n#\n## fruits.yml\napple\n:\nname\n:\napple\nIf the join table (\nfruit_monkeys\n) contains\ncreated_at\nor\nupdated_at\ncolumns,\nthese will now be populated when loading the fixture. Previously, fixture loading\nwould crash if these columns were required, and leave them as null otherwise.\nAlex Ghiculescu\nAllow applications to configure the thread pool for async queries.\nSome applications may want one thread pool per database whereas others want to use\na single global thread pool for all queries. By default, Rails will set\nasync_query_executor\nto\nnil\nwhich will not initialize any executor. If\nload_async\nis called and no executor\nhas been configured, the query will be executed in the foreground.\nTo create one thread pool for all database connections to use applications can set\nconfig.active_record.async_query_executor\nto\n:global_thread_pool\nand optionally define\nconfig.active_record.global_executor_concurrency\n. This defaults to 4. For applications that want\nto have a thread pool for each database connection,\nconfig.active_record.async_query_executor\ncan\nbe set to\n:multi_thread_pool\n. The configuration for each thread pool is set in the database\nconfiguration.\nEileen M. Uchitelle\nAllow new syntax for\nenum\nto avoid leading\n_\nfrom reserved options.\nBefore:\nclass\nBook\n<\nActiveRecord\n::\nBase\nenum\nstatus\n:\n[\n:proposed\n,\n:written\n]\n,\n_prefix\n:\ntrue\n,\n_scopes\n:\nfalse\nenum\ncover\n:\n[\n:hard\n,\n:soft\n]\n,\n_suffix\n:\ntrue\n,\n_default\n:\n:hard\nend\nAfter:\nclass\nBook\n<\nActiveRecord\n::\nBase\nenum\n:status\n,\n[\n:proposed\n,\n:written\n]\n,\nprefix\n:\ntrue\n,\nscopes\n:\nfalse\nenum\n:cover\n,\n[\n:hard\n,\n:soft\n]\n,\nsuffix\n:\ntrue\n,\ndefault\n:\n:hard\nend\nRyuta Kamizono\nAdd\nActiveRecord::Relation#load_async\n.\nThis method schedules the query to be performed asynchronously from a thread pool.\nIf the result is accessed before a background thread had the opportunity to perform\nthe query, it will be performed in the foreground.\nThis is useful for queries that can be performed long enough before their result will be\nneeded, or for controllers which need to perform several independent queries.\ndef\nindex\n@categories\n=\nCategory\n.\nsome_complex_scope\n.\nload_async\n@posts\n=\nPost\n.\nsome_complex_scope\n.\nload_async\nend\nActive Record logs will also include timing info for the duration of how long\nthe main thread had to wait to access the result. This timing is useful to know\nwhether or not it's worth to load the query asynchronously.\nDEBUG -- :   Category Load (62.1ms)  SELECT * FROM `categories` LIMIT 50\nDEBUG -- :   ASYNC Post Load (64ms) (db time 126.1ms)  SELECT * FROM `posts` LIMIT 100\nThe duration in the first set of parens is how long the main thread was blocked\nwaiting for the results, and the second set of parens with \"db time\" is how long\nthe entire query took to execute.\nJean Boussier\nImplemented\nActiveRecord::Relation#excluding\nmethod.\nThis method excludes the specified record (or collection of records) from\nthe resulting relation:\nPost\n.\nexcluding\n(\npost\n)\nPost\n.\nexcluding\n(\npost_one\n,\npost_two\n)\nAlso works on associations:\npost\n.\ncomments\n.\nexcluding\n(\ncomment\n)\npost\n.\ncomments\n.\nexcluding\n(\ncomment_one\n,\ncomment_two\n)\nThis is short-hand for\nPost.where.not(id: post.id)\n(for a single record)\nand\nPost.where.not(id: [post_one.id, post_two.id])\n(for a collection).\nGlen Crawford\nSkip optimised #exist? query when #include? is called on a relation\nwith a having clause.\nRelations that have aliased select values AND a having clause that\nreferences an aliased select value would generate an error when\n#include? was called, due to an optimisation that would generate\ncall #exists? on the relation instead, which effectively alters\nthe select values of the query (and thus removes the aliased select\nvalues), but leaves the having clause intact. Because the having\nclause is then referencing an aliased column that is no longer\npresent in the simplified query, an ActiveRecord::InvalidStatement\nerror was raised.\nA sample query affected by this problem:\nAuthor\n.\nselect\n(\n'COUNT(*) as total_posts'\n,\n'authors.*'\n)\n.\njoins\n(\n:posts\n)\n.\ngroup\n(\n:id\n)\n.\nhaving\n(\n'total_posts > 2'\n)\n.\ninclude?\n(\nAuthor\n.\nfirst\n)\nThis change adds an addition check to the condition that skips the\nsimplified #exists? query, which simply checks for the presence of\na having clause.\nFixes\n#41417\n.\nMichael Smart\nIncrement postgres prepared statement counter before making a prepared statement, so if the statement is aborted\nwithout Rails knowledge (e.g., if app gets killed during long-running query or due to Rack::Timeout), app won't end\nup in perpetual crash state for being inconsistent with PostgreSQL.\nwbharding\n,\nMartin Tepper\nAdd ability to apply\nscoping\nto\nall_queries\n.\nSome applications may want to use the\nscoping\nmethod but previously it only\nworked on certain types of queries. This change allows the\nscoping\nmethod to apply\nto all queries for a model in a block.\nPost\n.\nwhere\n(\nblog_id\n:\npost\n.\nblog_id\n)\n.\nscoping\n(\nall_queries\n:\ntrue\n)\ndo\npost\n.\nupdate\n(\ntitle\n:\n\"a post title\"\n)\n# adds `posts.blog_id = 1` to the query\nend\nEileen M. Uchitelle\nActiveRecord::Calculations.calculate\ncalled with\n:average\n(aliased as\nActiveRecord::Calculations.average\n) will now use column-based\ntype casting. This means that floating-point number columns will now be\naggregated as\nFloat\nand decimal columns will be aggregated as\nBigDecimal\n.\nIntegers are handled as a special case returning\nBigDecimal\nalways\n(this was the case before already).\n# With the following schema:\ncreate_table\n\"measurements\"\ndo\n|\nt\n|\nt\n.\nfloat\n\"temperature\"\nend\n# Before:\nMeasurement\n.\naverage\n(\n:temperature\n)\n.\nclass\n# => BigDecimal\n# After:\nMeasurement\n.\naverage\n(\n:temperature\n)\n.\nclass\n# => Float\nBefore this change, Rails just called\nto_d\non average aggregates from the\ndatabase adapter. This is not the case anymore. If you relied on that kind\nof magic, you now need to register your own\nActiveRecord::Type\n(see\nActiveRecord::Attributes::ClassMethods\nfor documentation).\nJosua Schmid\nPostgreSQL: introduce\nActiveRecord::ConnectionAdapters::PostgreSQLAdapter.datetime_type\n.\nThis setting controls what native type Active Record should use when you call\ndatetime\nin\na migration or schema. It takes a symbol which must correspond to one of the configured\nNATIVE_DATABASE_TYPES\n. The default is\n:timestamp\n, meaning\nt.datetime\nin a migration\nwill create a \"timestamp without time zone\" column. To use \"timestamp with time zone\",\nchange this to\n:timestamptz\nin an initializer.\nYou should run\nbin/rails db:migrate\nto rebuild your schema.rb if you change this.\nAlex Ghiculescu\nPostgreSQL: handle\ntimestamp with time zone\ncolumns correctly in\nschema.rb\n.\nPreviously they dumped as\nt.datetime :column_name\n, now they dump as\nt.timestamptz :column_name\n,\nand are created as\ntimestamptz\ncolumns when the schema is loaded.\nAlex Ghiculescu\nRemoving trailing whitespace when matching columns in\nActiveRecord::Sanitization.disallow_raw_sql!\n.\nGannon McGibbon\n,\nAdrian Hirt\nExpose a way for applications to set a\nprimary_abstract_class\n.\nMultiple database applications that use a primary abstract class that is not\nnamed\nApplicationRecord\ncan now set a specific class to be the\nprimary_abstract_class\n.\nclass\nPrimaryApplicationRecord\nself\n.\nprimary_abstract_class\nend\nWhen an application boots it automatically connects to the primary or first database in the\ndatabase configuration file. In a multiple database application that then call\nconnects_to\nneeds to know that the default connection is the same as the\nApplicationRecord\nconnection.\nHowever, some applications have a differently named\nApplicationRecord\n. This prevents Active\nRecord from opening duplicate connections to the same database.\nEileen M. Uchitelle\n,\nJohn Crepezzi\nSupport hash config for\nstructure_dump_flags\nand\nstructure_load_flags\nflags.\nNow that Active Record supports multiple databases configuration,\nwe need a way to pass specific flags for dump/load databases since\nthe options are not the same for different adapters.\nWe can use in the original way:\nActiveRecord\n::\nTasks\n::\nDatabaseTasks\n.\nstructure_dump_flags\n=\n[\n'--no-defaults'\n,\n'--skip-add-drop-table'\n]\n# or\nActiveRecord\n::\nTasks\n::\nDatabaseTasks\n.\nstructure_dump_flags\n=\n'--no-defaults --skip-add-drop-table'\nAnd also use it passing a hash, with one or more keys, where the key\nis the adapter\nActiveRecord\n::\nTasks\n::\nDatabaseTasks\n.\nstructure_dump_flags\n=\n{\nmysql2\n:\n[\n'--no-defaults'\n,\n'--skip-add-drop-table'\n]\n,\npostgres\n:\n'--no-tablespaces'\n}\nGustavo Gonzalez\nConnection specification now passes the \"url\" key as a configuration for the\nadapter if the \"url\" protocol is \"jdbc\", \"http\", or \"https\". Previously only\nurls with the \"jdbc\" prefix were passed to the Active Record Adapter, others\nare assumed to be adapter specification urls.\nFixes\n#41137\n.\nJonathan Bracy\nAllow to opt-out of\nstrict_loading\nmode on a per-record base.\nThis is useful when strict loading is enabled application wide or on a\nmodel level.\nclass\nUser\n<\nApplicationRecord\nhas_many\n:bookmarks\nhas_many\n:articles\n,\nstrict_loading\n:\ntrue\nend\nuser\n=\nUser\n.\nfirst\nuser\n.\narticles\n# => ActiveRecord::StrictLoadingViolationError\nuser\n.\nbookmarks\n# => #<ActiveRecord::Associations::CollectionProxy>\nuser\n.\nstrict_loading!\n(\ntrue\n)\n# => true\nuser\n.\nbookmarks\n# => ActiveRecord::StrictLoadingViolationError\nuser\n.\nstrict_loading!\n(\nfalse\n)\n# => false\nuser\n.\nbookmarks\n# => #<ActiveRecord::Associations::CollectionProxy>\nuser\n.\narticles\n.\nstrict_loading!\n(\nfalse\n)\n# => #<ActiveRecord::Associations::CollectionProxy>\nAyrton De Craene\nAdd\nFinderMethods#sole\nand\n#find_sole_by\nto find and assert the\npresence of exactly one record.\nUsed when you need a single row, but also want to assert that there aren't\nmultiple rows matching the condition; especially for when database\nconstraints aren't enough or are impractical.\nProduct\n.\nwhere\n(\n[\n\"price = %?\"\n,\nprice\n]\n)\n.\nsole\n# => ActiveRecord::RecordNotFound      (if no Product with given price)\n# => #<Product ...>                    (if one Product with given price)\n# => ActiveRecord::SoleRecordExceeded  (if more than one Product with given price)\nuser\n.\napi_keys\n.\nfind_sole_by\n(\nkey\n:\nkey\n)\n# as above\nAsherah Connor\nMakes\nActiveRecord::AttributeMethods::Query\nrespect the getter overrides defined in the model.\nBefore:\nclass\nUser\ndef\nadmin\nfalse\n# Overriding the getter to always return false\nend\nend\nuser\n=\nUser\n.\nfirst\nuser\n.\nupdate\n(\nadmin\n:\ntrue\n)\nuser\n.\nadmin\n# false (as expected, due to the getter overwrite)\nuser\n.\nadmin?\n# true (not expected, returned the DB column value)\nAfter this commit,\nuser.admin?\nabove returns false, as expected.\nFixes\n#40771\n.\nFelipe\nAllow delegated_type to be specified primary_key and foreign_key.\nSince delegated_type assumes that the foreign_key ends with\n_id\n,\nsingular_id\ndefined by it does not work when the foreign_key does\nnot end with\nid\n. This change fixes it by taking into account\nprimary_key\nand\nforeign_key\nin the options.\nRyota Egusa\nExpose an\ninvert_where\nmethod that will invert all scope conditions.\nclass\nUser\nscope\n:active\n,\n->\n{\nwhere\n(\naccepted\n:\ntrue\n,\nlocked\n:\nfalse\n)\n}\nend\nUser\n.\nactive\n# ... WHERE `accepted` = 1 AND `locked` = 0\nUser\n.\nactive\n.\ninvert_where\n# ... WHERE NOT (`accepted` = 1 AND `locked` = 0)\nKevin Deisz\nRestore possibility of passing\nfalse\nto :polymorphic option of\nbelongs_to\n.\nPreviously, passing\nfalse\nwould trigger the option validation logic\nto throw an error saying :polymorphic would not be a valid option.\nglaszig\nRemove deprecated\ndatabase\nkwarg from\nconnected_to\n.\nEileen M. Uchitelle\n,\nJohn Crepezzi\nAllow adding nonnamed expression indexes to be revertible.\nPreviously, the following code would raise an error, when executed while rolling back,\nand the index name should be specified explicitly. Now, the index name is inferred\nautomatically.\nadd_index\n(\n:items\n,\n\"to_tsvector('english', description)\"\n)\nFixes\n#40732\n.\nfatkodima\nOnly warn about negative enums if a positive form that would cause conflicts exists.\nFixes\n#39065\n.\nAlex Ghiculescu\nAdd option to run\ndefault_scope\non all queries.\nPreviously, a\ndefault_scope\nwould only run on select or insert queries. In some cases, like non-Rails tenant sharding solutions, it may be desirable to run\ndefault_scope\non all queries in order to ensure queries are including a foreign key for the shard (i.e.\nblog_id\n).\nNow applications can add an option to run on all queries including select, insert, delete, and update by adding an\nall_queries\noption to the default scope definition.\nclass\nArticle\n<\nApplicationRecord\ndefault_scope\n->\n{\nwhere\n(\nblog_id\n:\nCurrent\n.\nblog\n.\nid\n)\n}\n,\nall_queries\n:\ntrue\nend\nEileen M. Uchitelle\nAdd\nwhere.associated\nto check for the presence of an association.\n# Before:\naccount\n.\nusers\n.\njoins\n(\n:contact\n)\n.\nwhere\n.\nnot\n(\ncontact_id\n:\nnil\n)\n# After:\naccount\n.\nusers\n.\nwhere\n.\nassociated\n(\n:contact\n)\nAlso mirrors\nwhere.missing\n.\nKasper Timm Hansen\nAllow constructors (\nbuild_association\nand\ncreate_association\n) on\nhas_one :through\nassociations.\nSantiago Perez Perret\nActive Storage\nSupport transforming empty-ish\nhas_many_attached\nvalue into\n[]\n(e.g.\n[\"\"]\n).\n@user\n.\nhighlights\n=\n[\n\"\"\n]\n@user\n.\nhighlights\n# => []\nSean Doyle\nAdd ActiveStorage::Blob.compose\nto concatenate multiple blobs.\nGannon McGibbon\nSetting custom metadata on blobs are now persisted to remote storage.\njoshuamsager\nSupport direct uploads to multiple services.\nDmitry Tsepelev\nInvalid default content types are deprecated\nBlobs created with content_type\nimage/jpg\n,\nimage/pjpeg\n,\nimage/bmp\n,\ntext/javascript\nwill now produce\na deprecation warning, since these are not valid content types.\nThese content types will be removed from the defaults in Rails 7.1.\nYou can set\nconfig.active_storage.silence_invalid_content_types_warning = true\nto dismiss the warning.\nAlex Ghiculescu\nEmit Active Support instrumentation events from Active Storage analyzers.\nFixes\n#42930\nShouichi Kamiya\nAdd support for byte range requests\nTom Prats\nAttachments can be deleted after their association is no longer defined.\nFixes\n#42514\nDon Sisco\nMake\nvips\nthe default variant processor for new apps.\nSee the upgrade guide for instructions on converting from\nmini_magick\nto\nvips\n.\nmini_magick\nis\nnot deprecated, existing apps can keep using it.\nBreno Gazzola\nDeprecate\nActiveStorage::Current.host\nin favor of\nActiveStorage::Current.url_options\nwhich accepts\na host, protocol and port.\nSantiago Bartesaghi\nAllow using\nIAM\nwhen signing URLs with GCS.\ngcs\n:\nservice\n:\nGCS\n...\niam\n:\ntrue\nRRethy\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nDeprecate\nconfig.active_storage.replace_on_assign_to_many\n. Future versions of Rails\nwill behave the same way as when the config is set to\ntrue\n.\nSantiago Bartesaghi\nRemove deprecated methods:\nbuild_after_upload\n,\ncreate_after_upload!\nin favor of\ncreate_and_upload!\n,\nand\nservice_url\nin favor of\nurl\n.\nSantiago Bartesaghi\nAdd support of\nstrict_loading_by_default\nto\nActiveStorage::Representations\ncontrollers.\nAnton Topchii\n,\nAndrew White\nAllow to detach an attachment when record is not persisted.\nJacopo Beschi\nUse libvips instead of ImageMagick to analyze images when\nactive_storage.variant_processor = vips\n.\nBreno Gazzola\nAdd metadata value for presence of video channel in video blobs.\nThe\nmetadata\nattribute of video blobs has a new boolean key named\nvideo\nthat is set to\ntrue\nif the file has an video channel and\nfalse\nif it doesn't.\nBreno Gazzola\nDeprecate usage of\npurge\nand\npurge_later\nfrom the association extension.\nJacopo Beschi\nPassing extra parameters in\nActiveStorage::Blob#url\nto S3 Client.\nThis allows calls of\nActiveStorage::Blob#url\nto have more interaction with\nthe S3 Presigner, enabling, amongst other options, custom S3 domain URL\nGeneration.\nblob\n=\nActiveStorage\n::\nBlob\n.\nlast\nblob\n.\nurl\n# => https://<bucket-name>.s3.<region>.amazonaws.com/<key>\nblob\n.\nurl\n(\nvirtual_host\n:\ntrue\n)\n# => # => https://<bucket-name>/<key>\njosegomezr\nAllow setting a\nCache-Control\non files uploaded to GCS.\ngcs\n:\nservice\n:\nGCS\n...\ncache_control\n:\n\"\npublic, max-age=3600\n\"\nmaleblond\nThe parameters sent to\nffmpeg\nfor generating a video preview image are now\nconfigurable under\nconfig.active_storage.video_preview_arguments\n.\nBrendon Muir\nThe ActiveStorage video previewer will now use scene change detection to generate\nbetter preview images (rather than the previous default of using the first frame\nof the video). This change requires FFmpeg v3.4+.\nJonathan Hefner\nAdd support for ActiveStorage expiring URLs.\nrails_blob_path\n(\nuser\n.\navatar\n,\ndisposition\n:\n\"attachment\"\n,\nexpires_in\n:\n30\n.\nminutes\n)\n<%=\nimage_tag\nrails_blob_path\n(\nuser\n.\navatar\n.\nvariant\n(\nresize\n:\n\"100x100\"\n)\n,\nexpires_in\n:\n30\n.\nminutes\n)\n%>\nIf you want to set default expiration time for ActiveStorage URLs throughout your application, set\nconfig.active_storage.urls_expire_in\n.\naki77\nAllow to purge an attachment when record is not persisted for\nhas_many_attached\n.\nJacopo Beschi\nAdd\nwith_all_variant_records\nmethod to eager load all variant records on an attachment at once.\nwith_attached_image\nscope now eager loads variant records if using variant tracking.\nAlex Ghiculescu\nAdd metadata value for presence of audio channel in video blobs.\nThe\nmetadata\nattribute of video blobs has a new boolean key named\naudio\nthat is set to\ntrue\nif the file has an audio channel and\nfalse\nif it doesn't.\nBreno Gazzola\nAdds analyzer for audio files.\nBreno Gazzola\nRespect Active Record's primary_key_type in Active Storage migrations.\nfatkodima\nAllow\nexpires_in\nfor ActiveStorage signed ids.\naki77\nAllow to purge an attachment when record is not persisted for\nhas_one_attached\n.\nJacopo Beschi\nAdd a load hook called\nactive_storage_variant_record\n(providing\nActiveStorage::VariantRecord\n)\nto allow for overriding aspects of the\nActiveStorage::VariantRecord\nclass. This makes\nActiveStorage::VariantRecord\nconsistent with\nActiveStorage::Blob\nand\nActiveStorage::Attachment\nthat already have load hooks.\nBrendon Muir\nActiveStorage::PreviewError\nis raised when a previewer is unable to generate a preview image.\nAlex Robbin\nAdd\nActiveStorage::Streaming\nmodule that can be included in a controller to get access to\n#send_blob_stream\n,\nwhich wraps the new\nActionController::Base#send_stream\nmethod to stream a blob from cloud storage:\nclass\nMyPublicBlobsController\n<\nApplicationController\ninclude\nActiveStorage\n::\nSetBlob\n,\nActiveStorage\n::\nStreaming\ndef\nshow\nhttp_cache_forever\n(\npublic\n:\ntrue\n)\ndo\nsend_blob_stream\n@blob\n,\ndisposition\n:\nparams\n[\n:disposition\n]\nend\nend\nend\nDHH\nAdd ability to use pre-defined variants.\nclass\nUser\n<\nActiveRecord\n::\nBase\nhas_one_attached\n:avatar\ndo\n|\nattachable\n|\nattachable\n.\nvariant\n:thumb\n,\nresize\n:\n\"100x100\"\nattachable\n.\nvariant\n:medium\n,\nresize\n:\n\"300x300\"\n,\nmonochrome\n:\ntrue\nend\nend\nclass\nGallery\n<\nActiveRecord\n::\nBase\nhas_many_attached\n:photos\ndo\n|\nattachable\n|\nattachable\n.\nvariant\n:thumb\n,\nresize\n:\n\"100x100\"\nattachable\n.\nvariant\n:medium\n,\nresize\n:\n\"300x300\"\n,\nmonochrome\n:\ntrue\nend\nend\n<%=\nimage_tag\nuser\n.\navatar\n.\nvariant\n(\n:thumb\n)\n%>\nfatkodima\nAfter setting\nconfig.active_storage.resolve_model_to_route = :rails_storage_proxy\nrails_blob_path\nand\nrails_representation_path\nwill generate proxy URLs by default.\nAli Ismayilov\nDeclare\nActiveStorage::FixtureSet\nand\nActiveStorage::FixtureSet.blob\nto\nimprove fixture integration.\nSean Doyle\nActive Support\nFix\nActiveSupport::Duration.build\nto support negative values.\nThe algorithm to collect the\nparts\nof the\nActiveSupport::Duration\nignored the sign of the\nvalue\nand accumulated incorrect part values. This\nimpacted\nActiveSupport::Duration#sum\n(which is dependent on\nparts\n) but\nnot\nActiveSupport::Duration#eql?\n(which is dependent on\nvalue\n).\nCaleb Buxton\n,\nBraden Staudacher\nDeprecate passing a format to\n#to_s\nin favor of\n#to_formatted_s\nin\nArray\n,\nRange\n,\nDate\n,\nDateTime\n,\nTime\n,\nBigDecimal\n,\nFloat\nand,\nInteger\n.\nRafael Mendonça França\nDocument\nActiveSupport::Testing::Deprecation\n.\nSam Bostock & Sam Jordan\nAdd\nPathname#existence\n.\nPathname\n.\nnew\n(\n\"file\"\n)\n.\nexistence\n&.\nread\nTimo Schilling\nRemove deprecate\nActiveSupport::Multibyte::Unicode.default_normalization_form\n.\nRafael Mendonça França\nRemove deprecated support to use\nRange#include?\nto check the inclusion of a value in\na date time range is deprecated.\nRafael Mendonça França\nRemove deprecated\nURI.parser\n.\nRafael Mendonça França\nRemove deprecated\nconfig.active_support.use_sha1_digests\n.\nRafael Mendonça França\nInvoking\nObject#with_options\nwithout a\n&block\nargument returns the\nActiveSupport::OptionMerger\ninstance.\nSean Doyle\nRails.application.executor\nhooks can now be called around every test\nThis helps to better simulate request or job local state being reset around tests and prevents state\nleaking from one test to another.\nHowever it requires the executor hooks executed in the test environment to be re-entrant.\nTo enable this, set\nconfig.active_support.executor_around_test_case = true\n(this is the default in Rails 7).\nJean Boussier\nActiveSupport::DescendantsTracker\nnow mostly delegate to\nClass#descendants\non Ruby 3.1\nRuby now provides a fast\nClass#descendants\nmaking\nActiveSupport::DescendantsTracker\nmostly useless.\nAs a result the following methods are deprecated:\nActiveSupport::DescendantsTracker.direct_descendants\nActiveSupport::DescendantsTracker#direct_descendants\nJean Boussier\nFix the\nDigest::UUID.uuid_from_hash\nbehavior for namespace IDs that are different from the ones defined on\nDigest::UUID\n.\nThe new behavior will be enabled by setting the\nconfig.active_support.use_rfc4122_namespaced_uuids\noption to\ntrue\nand is the default for new apps.\nThe old behavior is the default for upgraded apps and will output a\ndeprecation warning every time a value that is different than one of\nthe constants defined on the\nDigest::UUID\nextension is used as the\nnamespace ID.\nAlex Robbin\n,\nErich Soares Machado\n,\nEugene Kenny\nActiveSupport::Inflector::Inflections#clear(:acronyms)\nis now supported,\nand\ninflector.clear\n/\ninflector.clear(:all)\nalso clears acronyms.\nAlex Ghiculescu\n,\nOliver Peate\nActiveSupport::Dependencies\nno longer installs a\nconst_missing\nhook. Before this, you could push to the autoload paths and have constants autoloaded. This feature, known as the\nclassic\nautoloader, has been removed.\nXavier Noria\nPrivate internal classes of\nActiveSupport::Dependencies\nhave been deleted, like\nActiveSupport::Dependencies::Reference\n,\nActiveSupport::Dependencies::Blamable\n, and others.\nXavier Noria\nThe private API of\nActiveSupport::Dependencies\nhas been deleted. That includes methods like\nhook!\n,\nunhook!\n,\ndepend_on\n,\nrequire_or_load\n,\nmechanism\n, and many others.\nXavier Noria\nImproves the performance of\nActiveSupport::NumberHelper\nformatters by avoiding the use of exceptions as flow control.\nMike Dalessio\nRemoved rescue block from\nActiveSupport::Cache::RedisCacheStore#handle_exception\nPreviously, if you provided a\nerror_handler\nto\nredis_cache_store\n, any errors thrown by\nthe error handler would be rescued and logged only. Removed the\nrescue\nclause from\nhandle_exception\nto allow these to be thrown.\nNicholas A. Stuart\nAllow entirely opting out of deprecation warnings.\nPreviously if you did\napp.config.active_support.deprecation = :silence\n, some work would\nstill be done on each call to\nActiveSupport::Deprecation.warn\n. In very hot paths, this could\ncause performance issues.\nNow, you can make\nActiveSupport::Deprecation.warn\na no-op:\nconfig\n.\nactive_support\n.\nreport_deprecations\n=\nfalse\nThis is the default in production for new apps. It is the equivalent to:\nconfig\n.\nactive_support\n.\ndeprecation\n=\n:silence\nconfig\n.\nactive_support\n.\ndisallowed_deprecation\n=\n:silence\nbut will take a more optimised code path.\nAlex Ghiculescu\nFaster tests by parallelizing only when overhead is justified by the number\nof them.\nRunning tests in parallel adds overhead in terms of database\nsetup and fixture loading. Now, Rails will only parallelize test executions when\nthere are enough tests to make it worth it.\nThis threshold is 50 by default, and is configurable via config setting in\nyour test.rb:\nconfig\n.\nactive_support\n.\ntest_parallelization_threshold\n=\n100\nIt's also configurable at the test case level:\nclass\nActiveSupport\n::\nTestCase\nparallelize\nthreshold\n:\n100\nend\nJorge Manrubia\nOpenSSL constants are now used for Digest computations.\nDirkjan Bussink\nTimeZone.iso8601\nnow accepts valid ordinal values similar to Ruby's\nDate._iso8601\nmethod.\nA valid ordinal value will be converted to an instance of\nTimeWithZone\nusing the\n:year\nand\n:yday\nfragments returned from\nDate._iso8601\n.\ntwz\n=\nActiveSupport\n::\nTimeZone\n[\n\"Eastern Time (US & Canada)\"\n]\n.\niso8601\n(\n\"21087\"\n)\ntwz\n.\nto_a\n[\n0\n,\n6\n]\n==\n[\n0\n,\n0\n,\n0\n,\n28\n,\n03\n,\n2021\n]\nSteve Laing\nTime#change\nand methods that call it (e.g.\nTime#advance\n) will now\nreturn a\nTime\nwith the timezone argument provided, if the caller was\ninitialized with a timezone argument.\nFixes\n#42467\n.\nAlex Ghiculescu\nAllow serializing any module or class to JSON by name.\nTyler Rick\n,\nZachary Scott\nRaise\nActiveSupport::EncryptedFile::MissingKeyError\nwhen the\nRAILS_MASTER_KEY\nenvironment variable is blank (e.g.\n\"\"\n).\nSunny Ripert\nThe\nfrom:\noption is added to\nActiveSupport::TestCase#assert_no_changes\n.\nIt permits asserting on the initial value that is expected not to change.\nassert_no_changes\n->\n{\nStatus\n.\nall_good?\n}\n,\nfrom\n:\ntrue\ndo\npost\n:create\n,\nparams\n:\n{\nstatus\n:\n{\nok\n:\ntrue\n}\n}\nend\nGeorge Claghorn\nDeprecate\nActiveSupport::SafeBuffer\n's incorrect implicit conversion of objects into string.\nExcept for a few methods like\nString#%\n, objects must implement\n#to_str\nto be implicitly converted to a String in string operations. In some\ncircumstances\nActiveSupport::SafeBuffer\nwas incorrectly calling the\nexplicit conversion method (\n#to_s\n) on them. This behavior is now\ndeprecated.\nJean Boussier\nAllow nested access to keys on\nRails.application.credentials\n.\nPreviously only top level keys in\ncredentials.yml.enc\ncould be accessed with method calls. Now any key can.\nFor example, given these secrets:\naws\n:\naccess_key_id\n:\n123\nsecret_access_key\n:\n345\nRails.application.credentials.aws.access_key_id\nwill now return the same thing as\nRails.application.credentials.aws[:access_key_id]\n.\nAlex Ghiculescu\nAdded a faster and more compact\nActiveSupport::Cache\nserialization format.\nIt can be enabled with\nconfig.active_support.cache_format_version = 7.0\nor\nconfig.load_defaults 7.0\n. Regardless of the configuration Active Support\n7.0 can read cache entries serialized by Active Support 6.1 which allows to\nupgrade without invalidating the cache. However Rails 6.1 can't read the\nnew format, so all readers must be upgraded before the new format is enabled.\nJean Boussier\nAdd\nEnumerable#sole\n, per\nActiveRecord::FinderMethods#sole\n.  Returns the\nsole item of the enumerable, raising if no items are found, or if more than\none is.\nAsherah Connor\nFreeze\nActiveSupport::Duration#parts\nand remove writer methods.\nDurations are meant to be value objects and should not be mutated.\nAndrew White\nFix\nActiveSupport::TimeZone#utc_to_local\nwith fractional seconds.\nWhen\nutc_to_local_returns_utc_offset_times\nis false and the time\ninstance had fractional seconds the new UTC time instance was out by\na factor of 1,000,000 as the\nTime.utc\nconstructor takes a usec\nvalue and not a fractional second value.\nAndrew White\nAdd\nexpires_at\nargument to\nActiveSupport::Cache\nwrite\nand\nfetch\nto set a cache entry TTL as an absolute time.\nRails\n.\ncache\n.\nwrite\n(\nkey\n,\nvalue\n,\nexpires_at\n:\nTime\n.\nnow\n.\nat_end_of_hour\n)\nJean Boussier\nDeprecate\nActiveSupport::TimeWithZone.name\nso that from Rails 7.1 it will use the default implementation.\nAndrew White\nDeprecates Rails custom\nEnumerable#sum\nand\nArray#sum\nin favor of Ruby's native implementation which\nis considerably faster.\nRuby requires an initializer for non-numeric type as per examples below:\n%w[\nfoo\nbar\n]\n.\nsum\n(\n''\n)\n# instead of %w[foo bar].sum\n[\n[\n1\n,\n2\n]\n,\n[\n3\n,\n4\n,\n5\n]\n]\n.\nsum\n(\n[\n]\n)\n# instead of [[1, 2], [3, 4, 5]].sum\nAlberto Mota\nTests parallelization is now disabled when running individual files to prevent the setup overhead.\nIt can still be enforced if the environment variable\nPARALLEL_WORKERS\nis present and set to a value greater than 1.\nRicardo Díaz\nFix proxying keyword arguments in\nActiveSupport::CurrentAttributes\n.\nMarcin Kołodziej\nAdd\nEnumerable#maximum\nand\nEnumerable#minimum\nto easily calculate the maximum or minimum from extracted\nelements of an enumerable.\npayments\n=\n[\nPayment\n.\nnew\n(\n5\n)\n,\nPayment\n.\nnew\n(\n15\n)\n,\nPayment\n.\nnew\n(\n10\n)\n]\npayments\n.\nminimum\n(\n:price\n)\n# => 5\npayments\n.\nmaximum\n(\n:price\n)\n# => 15\nThis also allows passing enumerables to\nfresh_when\nand\nstale?\nin Action Controller.\nSee PR\n#41404\nfor an example.\nAyrton De Craene\nActiveSupport::Cache::MemCacheStore\nnow accepts an explicit\nnil\nfor its\naddresses\nargument.\nconfig\n.\ncache_store\n=\n:mem_cache_store\n,\nnil\n# is now equivalent to\nconfig\n.\ncache_store\n=\n:mem_cache_store\n# and is also equivalent to\nconfig\n.\ncache_store\n=\n:mem_cache_store\n,\nENV\n[\n\"MEMCACHE_SERVERS\"\n]\n||\n\"localhost:11211\"\n# which is the fallback behavior of Dalli\nThis helps those migrating from\n:dalli_store\n, where an explicit\nnil\nwas permitted.\nMichael Overmeyer\nAdd\nEnumerable#in_order_of\nto put an Enumerable in a certain order by a key.\nDHH\nActiveSupport::Inflector.camelize\nbehaves expected when provided a symbol\n:upper\nor\n:lower\nargument. Matches\nString#camelize\nbehavior.\nAlex Ghiculescu\nRaises an\nArgumentError\nwhen the first argument of\nActiveSupport::Notification.subscribe\nis\ninvalid.\nVipul A M\nHashWithIndifferentAccess#deep_transform_keys\nnow returns a\nHashWithIndifferentAccess\ninstead of a\nHash\n.\nNathaniel Woodthorpe\nConsume dalli’s\ncache_nils\nconfiguration as\nActiveSupport::Cache\n's\nskip_nil\nwhen using\nMemCacheStore\n.\nRitikesh G\nAdd\nRedisCacheStore#stats\nmethod similar to\nMemCacheStore#stats\n. Calls\nredis#info\ninternally.\nRitikesh G\nGuides\nThe autoloading guide for\nzeitwerk\nmode has been revised.\nXavier Noria\nThe autoloading guide for\nclassic\nmode has been deleted.\nXavier Noria\nRailtie\nAllow localhost with a port by default in development\n[Fixes:\n#43864\n]\nRemove deprecated\nconfig\nin\ndbconsole\n.\nRafael Mendonça França\nChange default\nX-XSS-Protection\nheader to disable XSS auditor\nThis header has been deprecated and the XSS auditor it triggered\nhas been removed from all major modern browsers (in favour of\nContent Security Policy) that implemented this header to begin with\n(Firefox never did).\nOWASP\nsuggests setting this header to '0' to disable the default behaviour\non old browsers as it can introduce additional security issues.\nAdded the new behaviour as a framework default from Rails 7.0.\nChristian Sutter\nScaffolds now use date_field, time_field and datetime_field instead of\ndate_select, time_select and datetime_select; thus providing native date/time pickers.\nMartijn Lafeber\nFix a regression in which autoload paths were initialized too late.\nXavier Noria\nFix activestorage dependency in the npm package.\nRafael Mendonça França\nNew and upgraded Rails apps no longer generate\nconfig/initializers/application_controller_renderer.rb\nor\nconfig/initializers/cookies_serializer.rb\nThe default value for\ncookies_serializer\n(\n:json\n) has been moved to\nconfig.load_defaults(\"7.0\")\n.\nThe new framework defaults file can be used to upgrade the serializer.\nAlex Ghiculescu\nNew applications get a dependency on the new\ndebug\ngem, replacing\nbyebug\n.\nXavier Noria\nAdd SSL support for postgresql in\nbin/rails dbconsole\n.\nFixes\n#43114\n.\nMichael Bayucot\nAdd support for comments above gem declaration in Rails application templates, e.g.\ngem(\"nokogiri\", comment: \"For XML\")\n.\nLinas Juškevičius\nThe setter\nconfig.autoloader=\nhas been deleted.\nzeitwerk\nis the only\navailable autoloading mode.\nXavier Noria\nconfig.autoload_once_paths\ncan be configured in the body of the\napplication class defined in\nconfig/application.rb\nor in the configuration\nfor environments in\nconfig/environments/*\n.\nSimilarly, engines can configure that collection in the class body of the\nengine class or in the configuration for environments.\nAfter that, the collection is frozen, and you can autoload from those paths.\nThey are managed by the\nRails.autoloaders.once\nautoloader, which does not\nreload, only autoloads/eager loads.\nXavier Noria\nDuring initialization, you cannot autoload reloadable classes or modules\nlike application models, unless they are wrapped in a\nto_prepare\nblock.\nFor example, from\nconfig/initializers/*\n, or in application, engines, or\nrailties initializers.\nPlease check the\nautoloading\nguide\nfor details.\nXavier Noria\nWhile they are allowed to have elements in common, it is no longer required\nthat\nconfig.autoload_once_paths\nis a subset of\nconfig.autoload_paths\n.\nThe former are managed by the\nonce\nautoloader. The\nmain\nautoloader\nmanages the latter minus the former.\nXavier Noria\nShow Rake task description if command is run with\n-h\n.\nAdding\n-h\n(or\n--help\n) to a Rails command that's a Rake task now outputs\nthe task description instead of the general Rake help.\nPetrik de Heus\nAdd missing\nplugin new\ncommand to help.\n*Petrik de Heus\nFix\nconfig_for\nerror when there's only a shared root array.\nLoïc Delmaire\nRaise an error in generators if an index type is invalid.\nPetrik de Heus\npackage.json\nnow uses a strict version constraint for Rails JavaScript packages on new Rails apps.\nZachary Scott\n,\nAlex Ghiculescu\nModified scaffold generator template so that running\nrails g scaffold Author\nno longer generates tests called \"creating\na Author\", \"updating a Author\", and \"destroying a Author\".\nFixes\n#40744\n.\nMichael Duchemin\nRaise an error in generators if a field type is invalid.\nPetrik de Heus\nbin/rails tmp:clear\ndeletes also files and directories in\ntmp/storage\n.\nGeorge Claghorn\nFix compatibility with\npsych >= 4\n.\nStarting in Psych 4.0.0\nYAML.load\nbehaves like\nYAML.safe_load\n. To preserve compatibility\nRails.application.config_for\nnow uses\nYAML.unsafe_load\nif available.\nJean Boussier\nAllow loading nested locales in engines.\nGannon McGibbon\nEnsure\nRails.application.config_for\nalways cast hashes to\nActiveSupport::OrderedOptions\n.\nJean Boussier\nRemove\nRack::Runtime\nfrom the default middleware stack and deprecate\nreferencing it in middleware operations without adding it back.\nHartley McGuire\nAllow adding additional authorized hosts in development via\nENV['RAILS_DEVELOPMENT_HOSTS']\n.\nJosh Abernathy\n,\nDebbie Milburn\nAdd app concern and test keepfiles to generated engine plugins.\nGannon McGibbon\nStop generating a license for in-app plugins.\nGannon McGibbon\nrails app:update\nno longer prompts you to overwrite files that are generally modified in the\ncourse of developing a Rails app. See\n#41083\nfor\nthe full list of changes.\nAlex Ghiculescu\nChange default branch for new Rails projects and plugins to\nmain\n.\nPrateek Choudhary\nThe new method\nRails.benchmark\ngives you a quick way to measure and log the execution time taken by a block:\ndef test_expensive_stuff\n  Rails.benchmark(\"test_expensive_stuff\") { ... }\nend\nThis functionality was available in some contexts only before.\nSimon Perepelitsa\nApplications generated with\n--skip-sprockets\nno longer get\napp/assets/config/manifest.js\nand\napp/assets/stylesheets/application.css\n.\nCindy Gao\nAdd support for stylesheets and ERB views to\nrails stats\n.\nJoel Hawksley\nAllow appended root routes to take precedence over internal welcome controller.\nGannon McGibbon",
    "crawl_status": "success"
  }
]